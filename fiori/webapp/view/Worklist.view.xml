<mvc:View
    controllerName="cncchoco.queue.controller.Worklist"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns="sap.m"
    xmlns:f="sap.f"
    xmlns:core="sap.ui.core"
    xmlns:form="sap.ui.layout.form"
    xmlns:l="sap.ui.layout"
    height="100%">

    <VBox id="rootLayout" height="100%" class="sapUiNoMargin">

        <!-- Shell Bar -->
        <f:ShellBar id="shellBar"
            title="{i18n>appTitle}"
            secondTitle="{i18n>appSubtitle}"
            showCopilot="false"
            showSearch="false"
            showNotifications="false"
            showProductSwitcher="false">
            <f:additionalContent>
                <Button id="estopBtn"
                    text="{i18n>estop}"
                    type="Reject"
                    icon="sap-icon://warning"
                    press=".onEStop" />
                <Button id="connectionStatusBtn"
                    icon="{= ${cnc>/connected} ? 'sap-icon://connected' : 'sap-icon://disconnected'}"
                    text="{= ${cnc>/connected} ? 'Connected' : 'Disconnected'}"
                    type="{= ${cnc>/connected} ? 'Success' : 'Negative'}"
                    press=".onConnectionPress" />
            </f:additionalContent>
        </f:ShellBar>

        <!-- Info Strip -->
        <Toolbar id="infoStrip">
            <core:Icon
                src="sap-icon://message-information"
                color="{= ${cnc>/connected} ? '#107E3E' : '#BB0000'}"
                class="sapUiSmallMarginEnd" />
            <Label text="{= ${cnc>/connected} ? ${i18n>cncConnectedTo} : ${i18n>cncDisconnected}}" />
            <Label text="{cnc>/port}" visible="{cnc>/connected}" class="sapUiSmallMarginBegin" />
            <ToolbarSpacer />
            <Label text="{i18n>liveUpdates}" />
            <core:Icon src="sap-icon://record" color="#107E3E" class="sapUiSmallMarginBegin cncPulse" />
        </Toolbar>

        <!-- Main Navigation Tab Bar -->
        <IconTabBar id="mainTabBar"
            select=".onMainTabSelect"
            expandable="false"
            stretchContentHeight="true"
            applyContentPadding="false"
            headerMode="Inline">

            <layoutData>
                <FlexItemData growFactor="1" />
            </layoutData>

            <items>

                <!-- ═══════════════════════════════════════════════════════
                     QUEUE TAB
                ═══════════════════════════════════════════════════════ -->
                <IconTabFilter id="tabQueue"
                    key="Queue"
                    text="{i18n>navQueue}"
                    icon="sap-icon://list">

                    <!-- Status Filter Sub-Tabs -->
                    <IconTabBar id="statusTabBar"
                        select=".onFilterSelect"
                        stretchContentHeight="false"
                        applyContentPadding="true"
                        headerMode="Inline"
                        expandable="false">

                        <items>
                            <IconTabFilter id="tabAll"
                                key="All"
                                text="{i18n>filterAll}"
                                count="{queue>/statusCounts/all}"
                                showAll="true" />
                            <IconTabSeparator />
                            <IconTabFilter id="tabPending"
                                key="Pending"
                                text="{i18n>filterPending}"
                                count="{queue>/statusCounts/pending}"
                                iconColor="Critical"
                                icon="sap-icon://pending" />
                            <IconTabFilter id="tabPrinting"
                                key="Printing"
                                text="{i18n>filterPrinting}"
                                count="{queue>/statusCounts/printing}"
                                iconColor="Neutral"
                                icon="sap-icon://print" />
                            <IconTabFilter id="tabCompleted"
                                key="Completed"
                                text="{i18n>filterCompleted}"
                                count="{queue>/statusCounts/completed}"
                                iconColor="Positive"
                                icon="sap-icon://accept" />
                            <IconTabFilter id="tabCancelled"
                                key="Cancelled"
                                text="{i18n>filterCancelled}"
                                count="{queue>/statusCounts/cancelled}"
                                iconColor="Negative"
                                icon="sap-icon://decline" />
                        </items>

                        <content>
                            <!-- Table Toolbar -->
                            <OverflowToolbar id="tableToolbar">
                                <Title id="tableTitle" text="{i18n>queueTitle}" level="H3" />
                                <ToolbarSpacer />

                                <!-- Bulk Actions (visible when rows are selected) -->
                                <Select id="bulkStatusSelect"
                                    selectedKey="{view>/bulkStatus}"
                                    visible="{= ${view>/selectedCount} > 0}"
                                    class="sapUiSmallMarginEnd">
                                    <core:Item key="Pending" text="{i18n>statusPending}" />
                                    <core:Item key="Completed" text="{i18n>statusCompleted}" />
                                    <core:Item key="Cancelled_by_Admin" text="{i18n>statusCancelledAdmin}" />
                                </Select>
                                <Button id="bulkApplyBtn"
                                    text="{i18n>applyToSelected} ({view>/selectedCount})"
                                    type="Emphasized"
                                    icon="sap-icon://batch-payments"
                                    press=".onBulkApply"
                                    visible="{= ${view>/selectedCount} > 0}" />
                                <Button id="clearSelectionBtn"
                                    text="{i18n>clearSelection}"
                                    press=".onClearSelection"
                                    visible="{= ${view>/selectedCount} > 0}" />
                                <ToolbarSeparator visible="{= ${view>/selectedCount} > 0}" />

                                <Button id="printNextBtn"
                                    text="{i18n>printNext}"
                                    icon="sap-icon://print"
                                    type="Emphasized"
                                    press=".onPrintNext"
                                    enabled="{= !${queue>/isPrinting}}" />
                                <Button id="createJobBtn"
                                    text="{i18n>createJob}"
                                    icon="sap-icon://add"
                                    type="Ghost"
                                    press=".onCreateJob" />
                                <Button id="refreshBtn"
                                    icon="sap-icon://refresh"
                                    tooltip="{i18n>refresh}"
                                    press=".onRefresh" />
                            </OverflowToolbar>

                            <!-- Job Queue Table -->
                            <Table id="jobTable"
                                items="{queue>/jobs}"
                                mode="MultiSelect"
                                selectionChange=".onSelectionChange"
                                growing="true"
                                growingThreshold="50"
                                sticky="ColumnHeaders,HeaderToolbar"
                                alternateRowColors="true"
                                noDataText="{i18n>noJobs}">

                                <columns>
                                    <Column id="colId" width="5em" hAlign="Center">
                                        <Text text="{i18n>colId}" />
                                    </Column>
                                    <Column id="colName" minScreenWidth="Tablet" demandPopin="true">
                                        <Text text="{i18n>colName}" />
                                    </Column>
                                    <Column id="colMsg1">
                                        <Text text="{i18n>colMessage1}" />
                                    </Column>
                                    <Column id="colMsg2" minScreenWidth="Tablet" demandPopin="true">
                                        <Text text="{i18n>colMessage2}" />
                                    </Column>
                                    <Column id="colStatus" width="10em" hAlign="Center">
                                        <Text text="{i18n>colStatus}" />
                                    </Column>
                                    <Column id="colCreated" width="12em" minScreenWidth="Desktop" demandPopin="true" hAlign="Center">
                                        <Text text="{i18n>colCreated}" />
                                    </Column>
                                    <Column id="colActions" width="10em" hAlign="Center">
                                        <Text text="{i18n>colActions}" />
                                    </Column>
                                </columns>

                                <items>
                                    <ColumnListItem type="Navigation" press=".onViewJob">
                                        <cells>
                                            <Text text="{queue>id}" />
                                            <Text text="{queue>first_name} {queue>last_name}" />
                                            <Text text="{queue>message_1}" />
                                            <Text text="{queue>message_2}" />
                                            <ObjectStatus
                                                text="{ path: 'queue>status', formatter: '.formatter.statusText' }"
                                                state="{ path: 'queue>status', formatter: '.formatter.statusState' }"
                                                icon="{ path: 'queue>status', formatter: '.formatter.statusIcon' }" />
                                            <Text text="{ path: 'queue>created_at', formatter: '.formatter.formatDate' }" />
                                            <HBox justifyContent="Center">
                                                <Button
                                                    icon="sap-icon://print"
                                                    tooltip="{i18n>printJob}"
                                                    type="Ghost"
                                                    press=".onPrintJob"
                                                    visible="{ path: 'queue>status', formatter: '.formatter.isPending' }"
                                                    enabled="{= !${queue>/isPrinting}}" />
                                                <Button
                                                    icon="sap-icon://download"
                                                    tooltip="{i18n>downloadScript}"
                                                    type="Ghost"
                                                    press=".onDownloadScript" />
                                            </HBox>
                                        </cells>
                                    </ColumnListItem>
                                </items>
                            </Table>
                        </content>
                    </IconTabBar>
                </IconTabFilter>

                <!-- ═══════════════════════════════════════════════════════
                     STATISTICS TAB
                ═══════════════════════════════════════════════════════ -->
                <IconTabFilter id="tabStatistics"
                    key="Statistics"
                    text="{i18n>navStatistics}"
                    icon="sap-icon://bar-chart">

                    <VBox class="sapUiContentPadding">

                        <!-- KPI Tiles -->
                        <FlexBox wrap="Wrap" class="sapUiSmallMarginBottom cncStatGrid">
                            <GenericTile
                                class="sapUiTinyMarginEnd sapUiTinyMarginBottom cncStatTile"
                                header="{i18n>statTotalJobs}"
                                subheader="{i18n>statAllTime}">
                                <tileContent>
                                    <TileContent>
                                        <content>
                                            <NumericContent
                                                value="{stats>/totals/total_jobs_created}"
                                                withMargin="false"
                                                scale="" />
                                        </content>
                                    </TileContent>
                                </tileContent>
                            </GenericTile>

                            <GenericTile
                                class="sapUiTinyMarginEnd sapUiTinyMarginBottom cncStatTile cncStatSuccess"
                                header="{i18n>statCompleted}"
                                subheader="{i18n>statAllTime}">
                                <tileContent>
                                    <TileContent>
                                        <content>
                                            <NumericContent
                                                value="{stats>/totals/total_jobs_completed}"
                                                withMargin="false"
                                                valueColor="Good" />
                                        </content>
                                    </TileContent>
                                </tileContent>
                            </GenericTile>

                            <GenericTile
                                class="sapUiTinyMarginEnd sapUiTinyMarginBottom cncStatTile cncStatWarning"
                                header="{i18n>statPending}"
                                subheader="{i18n>statCurrent}">
                                <tileContent>
                                    <TileContent>
                                        <content>
                                            <NumericContent
                                                value="{stats>/statusCounts/Pending}"
                                                withMargin="false"
                                                valueColor="Critical" />
                                        </content>
                                    </TileContent>
                                </tileContent>
                            </GenericTile>

                            <GenericTile
                                class="sapUiTinyMarginEnd sapUiTinyMarginBottom cncStatTile cncStatDanger"
                                header="{i18n>statCancelled}"
                                subheader="{i18n>statAllTime}">
                                <tileContent>
                                    <TileContent>
                                        <content>
                                            <NumericContent
                                                value="{stats>/totals/total_jobs_cancelled}"
                                                withMargin="false"
                                                valueColor="Error" />
                                        </content>
                                    </TileContent>
                                </tileContent>
                            </GenericTile>

                            <GenericTile
                                class="sapUiTinyMarginEnd sapUiTinyMarginBottom cncStatTile"
                                header="{i18n>statLinesPrinted}"
                                subheader="{i18n>statAllTime}">
                                <tileContent>
                                    <TileContent>
                                        <content>
                                            <NumericContent
                                                value="{stats>/totals/total_lines_printed}"
                                                withMargin="false" />
                                        </content>
                                    </TileContent>
                                </tileContent>
                            </GenericTile>

                            <GenericTile
                                class="sapUiTinyMarginEnd sapUiTinyMarginBottom cncStatTile"
                                header="{i18n>statCharacters}"
                                subheader="{i18n>statAllTime}">
                                <tileContent>
                                    <TileContent>
                                        <content>
                                            <NumericContent
                                                value="{stats>/totals/total_chars_printed}"
                                                withMargin="false" />
                                        </content>
                                    </TileContent>
                                </tileContent>
                            </GenericTile>
                        </FlexBox>

                        <!-- Daily Activity Table -->
                        <Panel headerText="{i18n>statDailyActivity}" expandable="false" class="sapUiSmallMarginBottom">
                            <content>
                                <Table
                                    items="{stats>/dailyStats}"
                                    noDataText="{i18n>noStatsData}"
                                    alternateRowColors="true">
                                    <columns>
                                        <Column width="8em">
                                            <Text text="{i18n>statDate}" />
                                        </Column>
                                        <Column hAlign="Center" width="7em">
                                            <Text text="{i18n>statCreated}" />
                                        </Column>
                                        <Column hAlign="Center" width="7em">
                                            <Text text="{i18n>statCompletedCol}" />
                                        </Column>
                                        <Column hAlign="Center" width="7em">
                                            <Text text="{i18n>statCancelledCol}" />
                                        </Column>
                                        <Column hAlign="Center" width="7em">
                                            <Text text="{i18n>statLinesCol}" />
                                        </Column>
                                        <Column hAlign="Center" width="7em">
                                            <Text text="{i18n>statCharsCol}" />
                                        </Column>
                                    </columns>
                                    <items>
                                        <ColumnListItem>
                                            <cells>
                                                <Text text="{stats>date}" />
                                                <Text text="{stats>jobs_created}" />
                                                <Text text="{stats>jobs_completed}" />
                                                <Text text="{stats>jobs_cancelled}" />
                                                <Text text="{stats>lines_printed}" />
                                                <Text text="{stats>chars_printed}" />
                                            </cells>
                                        </ColumnListItem>
                                    </items>
                                </Table>
                            </content>
                        </Panel>

                        <!-- Charts 2x2 -->
                        <l:Grid defaultSpan="XL6 L6 M12 S12" class="sapUiNoMargin">
                            <Panel headerText="{i18n>statJobsByStatus}" expandable="false" class="sapUiSmallMarginBottom">
                                <content>
                                    <core:HTML id="statusChartHtml" sanitizeContent="false" preferDOM="true"
                                        content="&lt;div style='padding:0.75rem;height:300px'&gt;&lt;canvas id='cncStatusChart'&gt;&lt;/canvas&gt;&lt;/div&gt;" />
                                </content>
                            </Panel>
                            <Panel headerText="{i18n>statDailyActivity30}" expandable="false" class="sapUiSmallMarginBottom">
                                <content>
                                    <core:HTML id="dailyChartHtml" sanitizeContent="false" preferDOM="true"
                                        content="&lt;div style='padding:0.75rem;height:300px'&gt;&lt;canvas id='cncDailyChart'&gt;&lt;/canvas&gt;&lt;/div&gt;" />
                                </content>
                            </Panel>
                            <Panel headerText="{i18n>statCharsActivity30}" expandable="false" class="sapUiSmallMarginBottom">
                                <content>
                                    <core:HTML id="charsChartHtml" sanitizeContent="false" preferDOM="true"
                                        content="&lt;div style='padding:0.75rem;height:300px'&gt;&lt;canvas id='cncCharsChart'&gt;&lt;/canvas&gt;&lt;/div&gt;" />
                                </content>
                            </Panel>
                            <Panel headerText="{i18n>statCompletionRate}" expandable="false" class="sapUiSmallMarginBottom">
                                <content>
                                    <core:HTML id="completionChartHtml" sanitizeContent="false" preferDOM="true"
                                        content="&lt;div style='padding:0.75rem;height:300px'&gt;&lt;canvas id='cncCompletionChart'&gt;&lt;/canvas&gt;&lt;/div&gt;" />
                                </content>
                            </Panel>
                        </l:Grid>

                    </VBox>
                </IconTabFilter>

                <!-- ═══════════════════════════════════════════════════════
                     CONFIGURATION TAB
                ═══════════════════════════════════════════════════════ -->
                <IconTabFilter id="tabConfiguration"
                    key="Configuration"
                    text="{i18n>navConfiguration}"
                    icon="sap-icon://settings">

                    <VBox class="sapUiContentPadding">

                        <!-- Fixed 3-column grid at all screen sizes -->
                        <l:Grid defaultSpan="XL4 L4 M4 S4" class="sapUiNoMargin sapUiSmallMarginBottom cncCfgGrid">

                            <!-- ── Chocolate Bar ───────────────────────── -->
                            <Panel headerText="{i18n>configBarSection}" expandable="false" class="cncCfgPanel">
                                <content>
                                    <form:SimpleForm editable="true" layout="ResponsiveGridLayout"
                                        labelSpanXL="6" labelSpanL="6" labelSpanM="6" labelSpanS="12"
                                        emptySpanXL="0" emptySpanL="0" emptySpanM="0"
                                        columnsXL="1" columnsL="1" columnsM="1">
                                        <Label text="{i18n>configBarWidth}" />
                                        <StepInput value="{config>/bar_width}" min="10" max="500" step="0.1" displayValuePrecision="1" />
                                        <Label text="{i18n>configBarHeight}" />
                                        <StepInput value="{config>/bar_height}" min="10" max="500" step="0.1" displayValuePrecision="1" />
                                    </form:SimpleForm>
                                </content>
                            </Panel>

                            <!-- ── Template ────────────────────────────── -->
                            <Panel headerText="{i18n>configTemplateSection}" expandable="false" class="cncCfgPanel">
                                <content>
                                    <form:SimpleForm editable="true" layout="ResponsiveGridLayout"
                                        labelSpanXL="6" labelSpanL="6" labelSpanM="6" labelSpanS="12"
                                        emptySpanXL="0" emptySpanL="0" emptySpanM="0"
                                        columnsXL="1" columnsL="1" columnsM="1">
                                        <Label text="{i18n>configTemplateText}" />
                                        <Input value="{config>/template_text}" />
                                        <Label text="{i18n>configTemplateFont}" />
                                        <Select selectedKey="{config>/template_font}">
                                            <core:Item key="logo" text="Logo" />
                                        </Select>
                                        <Label text="{i18n>configTemplateFontSize}" />
                                        <StepInput value="{config>/template_font_size}" min="1" max="50" step="0.1" displayValuePrecision="1" />
                                        <Label text="{i18n>configTemplateAlignment}" />
                                        <Select selectedKey="{config>/template_alignment}">
                                            <core:Item key="left" text="{i18n>alignLeft}" />
                                            <core:Item key="centered" text="{i18n>alignCentered}" />
                                            <core:Item key="right" text="{i18n>alignRight}" />
                                        </Select>
                                    </form:SimpleForm>
                                </content>
                            </Panel>

                            <!-- ── Messages ────────────────────────────── -->
                            <Panel headerText="{i18n>configMessagesSection}" expandable="false" class="cncCfgPanel">
                                <content>
                                    <form:SimpleForm editable="true" layout="ResponsiveGridLayout"
                                        labelSpanXL="6" labelSpanL="6" labelSpanM="6" labelSpanS="12"
                                        emptySpanXL="0" emptySpanL="0" emptySpanM="0"
                                        columnsXL="1" columnsL="1" columnsM="1">
                                        <Label text="{i18n>configMessageFont}" />
                                        <Select selectedKey="{config>/message_font}">
                                            <core:Item key="hershey" text="Hershey" />
                                            <core:Item key="block" text="Block" />
                                            <core:Item key="script" text="Script" />
                                            <core:Item key="pristina" text="Pristina" />
                                            <core:Item key="calibri" text="Calibri" />
                                        </Select>
                                        <Label text="{i18n>configMessageAlignment}" />
                                        <Select selectedKey="{config>/message_alignment}">
                                            <core:Item key="left" text="{i18n>alignLeft}" />
                                            <core:Item key="centered" text="{i18n>alignCentered}" />
                                        </Select>
                                        <Label text="{i18n>configMsgFontSize1}" />
                                        <StepInput value="{config>/message_font_size_1_line}" min="1" max="50" step="0.1" displayValuePrecision="1" />
                                        <Label text="{i18n>configMsgFontSize2}" />
                                        <StepInput value="{config>/message_font_size_2_lines}" min="1" max="50" step="0.1" displayValuePrecision="1" />
                                    </form:SimpleForm>
                                </content>
                            </Panel>

                            <!-- ── Spacing ─────────────────────────────── -->
                            <Panel headerText="{i18n>configSpacingSection}" expandable="false" class="cncCfgPanel">
                                <content>
                                    <form:SimpleForm editable="true" layout="ResponsiveGridLayout"
                                        labelSpanXL="6" labelSpanL="6" labelSpanM="6" labelSpanS="12"
                                        emptySpanXL="0" emptySpanL="0" emptySpanM="0"
                                        columnsXL="1" columnsL="1" columnsM="1">
                                        <Label text="{i18n>configGapTemplateMsg}" />
                                        <StepInput value="{config>/gap_template_to_message}" min="-20" max="50" step="0.1" displayValuePrecision="1" />
                                        <Label text="{i18n>configGapBetweenLines}" />
                                        <StepInput value="{config>/gap_between_lines}" min="0" max="50" step="0.1" displayValuePrecision="1" />
                                    </form:SimpleForm>
                                </content>
                            </Panel>

                            <!-- ── CNC Settings ───────────────────────── -->
                            <Panel headerText="{i18n>configCNCSection}" expandable="false" class="cncCfgPanel">
                                <content>
                                    <form:SimpleForm editable="true" layout="ResponsiveGridLayout"
                                        labelSpanXL="6" labelSpanL="6" labelSpanM="6" labelSpanS="12"
                                        emptySpanXL="0" emptySpanL="0" emptySpanM="0"
                                        columnsXL="1" columnsL="1" columnsM="1">
                                        <Label text="{i18n>configZSafeHeight}" />
                                        <StepInput value="{config>/z_safe_height}" min="0" max="50" step="0.1" displayValuePrecision="1" />
                                        <Label text="{i18n>configZEngraveDepth}" />
                                        <StepInput value="{config>/z_engrave_depth}" min="-10" max="0" step="0.1" displayValuePrecision="1" />
                                        <Label text="{i18n>configFeedRate}" />
                                        <StepInput value="{config>/feed_rate}" min="10" max="2000" step="10" />
                                    </form:SimpleForm>
                                </content>
                            </Panel>

                            <!-- ── Calibration Settings ───────────────── -->
                            <Panel headerText="{i18n>configCalibrationSection}" expandable="false" class="cncCfgPanel">
                                <content>
                                    <form:SimpleForm editable="true" layout="ResponsiveGridLayout"
                                        labelSpanXL="6" labelSpanL="6" labelSpanM="6" labelSpanS="12"
                                        emptySpanXL="0" emptySpanL="0" emptySpanM="0"
                                        columnsXL="1" columnsL="1" columnsM="1">
                                        <Label text="{i18n>configUseG54}" />
                                        <Select selectedKey="{config>/use_g54_calibration}">
                                            <core:Item key="true" text="{i18n>configG54Yes}" />
                                            <core:Item key="false" text="{i18n>configG54No}" />
                                        </Select>
                                        <Label text="{i18n>configJogFeedRate}" />
                                        <StepInput value="{config>/jog_feed_rate}" min="10" max="5000" step="10" />
                                    </form:SimpleForm>
                                </content>
                            </Panel>

                            <!-- ── Spindle ─────────────────────────────── -->
                            <Panel headerText="{i18n>configSpindleSection}" expandable="false" class="cncCfgPanel">
                                <content>
                                    <form:SimpleForm editable="true" layout="ResponsiveGridLayout"
                                        labelSpanXL="6" labelSpanL="6" labelSpanM="6" labelSpanS="12"
                                        emptySpanXL="0" emptySpanL="0" emptySpanM="0"
                                        columnsXL="1" columnsL="1" columnsM="1">
                                        <Label text="{i18n>configSpindleEnabled}" />
                                        <Select selectedKey="{config>/spindle_enabled}">
                                            <core:Item key="true" text="{i18n>configSpindleOn}" />
                                            <core:Item key="false" text="{i18n>configSpindleOff}" />
                                        </Select>
                                        <Label text="{i18n>configSpindleSpeed}" />
                                        <StepInput value="{config>/spindle_speed}" min="0" max="1000" step="10" />
                                    </form:SimpleForm>
                                </content>
                            </Panel>

                        </l:Grid>

                        <Toolbar>
                            <ToolbarSpacer />
                            <Button text="{i18n>saveConfig}" type="Emphasized" icon="sap-icon://save" press=".onSaveConfig" />
                            <Button text="{i18n>resetConfig}" icon="sap-icon://undo" press=".onResetConfig" />
                        </Toolbar>
                    </VBox>
                </IconTabFilter>

                <!-- ═══════════════════════════════════════════════════════
                     CALIBRATION TAB
                ═══════════════════════════════════════════════════════ -->
                <IconTabFilter id="tabCalibration"
                    key="Calibration"
                    text="{i18n>navCalibration}"
                    icon="sap-icon://target-group">

                    <VBox class="sapUiContentPadding cncCalibrationTab">

                            <!-- Two-column body: left = controls, right = jog pad -->
                            <l:Grid defaultSpan="XL6 L6 M12 S12" class="sapUiNoMargin">

                                <!-- LEFT COLUMN: position + step actions -->
                                <VBox class="cncCalCol">

                                    <!-- Position Readout -->
                                    <Panel headerText="{i18n>calPosition}" expandable="false" class="sapUiSmallMarginBottom">
                                        <content>
                                            <VBox class="sapUiSmallMargin">
                                                <HBox alignItems="Center" class="sapUiSmallMarginBottom">
                                                    <Label text="{i18n>calGrblState}" class="sapUiSmallMarginEnd" />
                                                    <ObjectStatus text="{calibration>/state}" />
                                                </HBox>
                                                <l:Grid defaultSpan="XL6 L6 M6 S12" class="sapUiNoMargin">
                                                    <VBox>
                                                        <Label text="{i18n>calMPos}" design="Bold" />
                                                        <HBox class="sapUiTinyMarginTop">
                                                            <ObjectStatus title="X" text="{calibration>/mpos/x}" class="cncPosCoord sapUiSmallMarginEnd" />
                                                            <ObjectStatus title="Y" text="{calibration>/mpos/y}" class="cncPosCoord sapUiSmallMarginEnd" />
                                                            <ObjectStatus title="Z" text="{calibration>/mpos/z}" class="cncPosCoord" />
                                                        </HBox>
                                                    </VBox>
                                                    <VBox>
                                                        <Label text="{i18n>calWPos}" design="Bold" />
                                                        <HBox class="sapUiTinyMarginTop">
                                                            <ObjectStatus title="X" text="{calibration>/wpos/x}" class="cncPosCoord sapUiSmallMarginEnd" />
                                                            <ObjectStatus title="Y" text="{calibration>/wpos/y}" class="cncPosCoord sapUiSmallMarginEnd" />
                                                            <ObjectStatus title="Z" text="{calibration>/wpos/z}" class="cncPosCoord" />
                                                        </HBox>
                                                    </VBox>
                                                </l:Grid>
                                            </VBox>
                                        </content>
                                    </Panel>

                                    <!-- Step 1: Home -->
                                    <Panel headerText="{i18n>calStep1}" expandable="false" class="sapUiSmallMarginBottom">
                                        <content>
                                            <VBox class="sapUiSmallMargin">
                                                <HBox alignItems="Center" wrap="Wrap">
                                                    <Button id="homeBtn"
                                                        text="{i18n>calHomeBtn}"
                                                        type="Emphasized"
                                                        icon="sap-icon://home"
                                                        press=".onHome" />
                                                    <Button
                                                        text="{i18n>calUnlockBtn}"
                                                        type="Default"
                                                        icon="sap-icon://unlocked"
                                                        press=".onUnlock"
                                                        class="sapUiSmallMarginBegin" />
                                                    <Text id="homeStatus"
                                                        text="{calibration>/homeStatus}"
                                                        class="sapUiSmallMarginBegin" />
                                                </HBox>
                                            </VBox>
                                        </content>
                                    </Panel>

                                    <!-- Step 3: Set Origin -->
                                    <Panel headerText="{i18n>calStep3}" expandable="false" class="sapUiSmallMarginBottom">
                                        <content>
                                            <VBox class="sapUiSmallMargin">
                                                <HBox alignItems="Center" wrap="Wrap">
                                                    <Button id="setOriginBtn"
                                                        text="{i18n>calSetOriginBtn}"
                                                        type="Success"
                                                        icon="sap-icon://map"
                                                        press=".onSetOrigin" />
                                                    <Button id="setOriginRelBtn"
                                                        text="{i18n>calQuickSetOriginBtn}"
                                                        type="Default"
                                                        icon="sap-icon://locate-me"
                                                        press=".onSetOriginRelative"
                                                        class="sapUiSmallMarginBegin" />
                                                    <Text id="originStatus"
                                                        text="{calibration>/originStatus}"
                                                        class="sapUiSmallMarginBegin" />
                                                </HBox>
                                            </VBox>
                                        </content>
                                    </Panel>

                                    <!-- Go to Position -->
                                    <Panel headerText="{i18n>calGoToPosition}" expandable="false" class="sapUiSmallMarginBottom">
                                        <content>
                                            <VBox class="sapUiSmallMargin">
                                                <HBox alignItems="Center" wrap="Wrap">
                                                    <Label text="X" class="sapUiSmallMarginEnd" />
                                                    <Input id="gotoX" value="{calibration>/gotoX}" width="5rem" placeholder="—" class="sapUiSmallMarginEnd" />
                                                    <Label text="Y" class="sapUiSmallMarginEnd" />
                                                    <Input id="gotoY" value="{calibration>/gotoY}" width="5rem" placeholder="—" class="sapUiSmallMarginEnd" />
                                                    <Label text="Z" class="sapUiSmallMarginEnd" />
                                                    <Input id="gotoZ" value="{calibration>/gotoZ}" width="5rem" placeholder="—" class="sapUiSmallMarginEnd" />
                                                </HBox>
                                                <HBox class="sapUiTinyMarginTop" wrap="Wrap">
                                                    <Button text="{i18n>calGoToBtn}" type="Default" press=".onMoveTo" class="sapUiSmallMarginEnd" />
                                                    <Button text="{i18n>calGoToOriginBtn}" type="Default" press=".onGoToOrigin" class="sapUiSmallMarginEnd" />
                                                    <Text id="moveToStatus" text="{calibration>/moveToStatus}" />
                                                </HBox>
                                            </VBox>
                                        </content>
                                    </Panel>

                                </VBox>

                                <!-- RIGHT COLUMN: jog pad -->
                                <VBox class="cncCalCol">
                                    <Panel headerText="{i18n>calStep2}" expandable="false" class="sapUiSmallMarginBottom">
                                        <content>
                                            <VBox class="sapUiSmallMargin" alignItems="Center">

                                                <!-- Step size selector -->
                                                <HBox alignItems="Center" class="sapUiSmallMarginBottom">
                                                    <Label text="{i18n>calStepSize}" class="sapUiSmallMarginEnd" />
                                                    <SegmentedButton id="jogStepBtn"
                                                        selectedKey="{calibration>/jogStep}"
                                                        selectionChange=".onJogStepChange">
                                                        <items>
                                                            <SegmentedButtonItem key="0.1" text="0.1" />
                                                            <SegmentedButtonItem key="1" text="1" />
                                                            <SegmentedButtonItem key="5" text="5" />
                                                            <SegmentedButtonItem key="10" text="10" />
                                                        </items>
                                                    </SegmentedButton>
                                                    <Label text="mm" class="sapUiSmallMarginBegin" />
                                                </HBox>

                                                <!-- Jog Pad -->
                                                <HBox justifyContent="Center" alignItems="Center" class="sapUiMediumMarginTopBottom">
                                                    <!-- XY Pad -->
                                                    <VBox alignItems="Center" class="cncJogPad">
                                                        <Button text="Y+" class="cncJogBtn" press=".onJogYPlus" />
                                                        <HBox>
                                                            <Button text="X-" class="cncJogBtn" press=".onJogXMinus" />
                                                            <Button icon="sap-icon://stop" class="cncJogBtn cncJogStop" press=".onJogCancel" tooltip="{i18n>calJogStop}" />
                                                            <Button text="X+" class="cncJogBtn" press=".onJogXPlus" />
                                                        </HBox>
                                                        <Button text="Y-" class="cncJogBtn" press=".onJogYMinus" />
                                                    </VBox>
                                                    <!-- Z Pad -->
                                                    <VBox alignItems="Center" class="cncJogZ sapUiLargeMarginBegin">
                                                        <Label text="Z" class="sapUiTinyMarginBottom" />
                                                        <Button text="Z+" class="cncJogBtn" press=".onJogZPlus" />
                                                        <Button text="Z-" class="cncJogBtn sapUiTinyMarginTop" press=".onJogZMinus" />
                                                    </VBox>
                                                </HBox>

                                            </VBox>
                                        </content>
                                    </Panel>
                                </VBox>

                            </l:Grid>

                            <!-- Trace Print Area (full width) -->
                            <Panel headerText="{i18n>calTracePrintArea}" expandable="false" class="sapUiSmallMarginBottom">
                                <content>
                                    <VBox class="sapUiSmallMargin">
                                        <Text text="{i18n>calTracePrintAreaDesc}" wrapping="true" class="sapUiSmallMarginBottom" />
                                        <HBox alignItems="Center" wrap="Wrap">
                                            <Label text="{i18n>calTraceJobId}" class="sapUiSmallMarginEnd" />
                                            <Input id="traceJobIdInput"
                                                value="{calibration>/traceJobId}"
                                                width="8rem"
                                                placeholder="next pending"
                                                class="sapUiSmallMarginEnd" />
                                            <Button id="traceJobBtn"
                                                text="{i18n>calTraceBtn}"
                                                type="Default"
                                                icon="sap-icon://map"
                                                press=".onTraceJobArea"
                                                class="sapUiSmallMarginEnd" />
                                            <Text text="{calibration>/traceStatus}" />
                                        </HBox>
                                    </VBox>
                                </content>
                            </Panel>

                    </VBox>
                </IconTabFilter>

                <!-- ═══════════════════════════════════════════════════════
                     API DOCS TAB
                ═══════════════════════════════════════════════════════ -->
                <IconTabFilter id="tabApiDocs"
                    key="ApiDocs"
                    text="{i18n>navApiDocs}"
                    icon="sap-icon://developer-settings">
                    <core:HTML id="apiDocsHtml" sanitizeContent="false"
                        content="&lt;iframe src='/api-docs' style='width:100%;height:calc(100vh - 160px);border:none;display:block'&gt;&lt;/iframe&gt;" />
                </IconTabFilter>

                <!-- ═══════════════════════════════════════════════════════
                     SPEC TAB
                ═══════════════════════════════════════════════════════ -->
                <IconTabFilter id="tabSpec"
                    key="Spec"
                    text="{i18n>navSpec}"
                    icon="sap-icon://document">
                    <core:HTML id="specHtml" sanitizeContent="false"
                        content="&lt;iframe src='/docs/CNC_Chocolate_Engraver_Specification.html' style='width:100%;height:calc(100vh - 160px);border:none;display:block;background:#fff'&gt;&lt;/iframe&gt;" />
                </IconTabFilter>

            </items>
        </IconTabBar>
    </VBox>
</mvc:View>
