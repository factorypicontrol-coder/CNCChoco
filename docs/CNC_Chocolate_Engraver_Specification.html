<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CNC Chocolate Engraver - Technical Specification</title>
  <style>
    body {
      font-family: 'Calibri', 'Segoe UI', Arial, sans-serif;
      line-height: 1.6;
      max-width: 8.5in;
      margin: 0 auto;
      padding: 1in;
      color: #333;
      font-size: 11pt;
    }
    h1 {
      color: #1a5276;
      border-bottom: 3px solid #1a5276;
      padding-bottom: 10px;
      font-size: 24pt;
    }
    h2 {
      color: #2874a6;
      border-bottom: 2px solid #2874a6;
      padding-bottom: 5px;
      margin-top: 30px;
      font-size: 18pt;
    }
    h3 {
      color: #3498db;
      margin-top: 25px;
      font-size: 14pt;
    }
    h4 {
      color: #5dade2;
      margin-top: 20px;
      font-size: 12pt;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      margin: 15px 0;
      font-size: 10pt;
    }
    th, td {
      border: 1px solid #bdc3c7;
      padding: 10px;
      text-align: left;
    }
    th {
      background-color: #2874a6;
      color: white;
    }
    tr:nth-child(even) {
      background-color: #f8f9fa;
    }
    code {
      background-color: #f4f4f4;
      padding: 2px 6px;
      border-radius: 3px;
      font-family: 'Consolas', 'Courier New', monospace;
      font-size: 10pt;
    }
    pre {
      background-color: #f4f4f4;
      padding: 15px;
      border-radius: 5px;
      overflow-x: auto;
      font-family: 'Consolas', 'Courier New', monospace;
      font-size: 9pt;
    }
    .cover-page {
      text-align: center;
      margin-top: 3in;
      page-break-after: always;
    }
    .cover-title {
      font-size: 32pt;
      color: #1a5276;
      margin-bottom: 20px;
    }
    .cover-subtitle {
      font-size: 18pt;
      color: #5dade2;
      margin-bottom: 40px;
    }
    .cover-info {
      font-size: 12pt;
      color: #666;
      margin-top: 100px;
    }
    .toc {
      page-break-after: always;
    }
    .toc ul {
      list-style: none;
      padding-left: 20px;
    }
    .toc li {
      margin: 8px 0;
    }
    .toc a {
      text-decoration: none;
      color: #2874a6;
    }
    .diagram-placeholder {
      border: 2px dashed #bdc3c7;
      padding: 40px;
      text-align: center;
      background-color: #f8f9fa;
      margin: 20px 0;
      color: #7f8c8d;
    }
    .note {
      background-color: #e8f6f3;
      border-left: 4px solid #1abc9c;
      padding: 15px;
      margin: 15px 0;
    }
    .warning {
      background-color: #fef9e7;
      border-left: 4px solid #f39c12;
      padding: 15px;
      margin: 15px 0;
    }
    .section-number {
      color: #7f8c8d;
      margin-right: 10px;
    }
    @media print {
      body { padding: 0.5in; }
      h1, h2 { page-break-after: avoid; }
      table, pre { page-break-inside: avoid; }
    }
  </style>
</head>
<body>

<!-- Cover Page -->
<div class="cover-page">
  <div class="cover-title">CNC Chocolate Engraver</div>
  <div class="cover-subtitle">Functional, Technical & Architectural Specification</div>
  <div style="margin-top: 50px;">
    <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='150' height='150'%3E%3Crect fill='%231a5276' width='150' height='150' rx='20'/%3E%3Ctext x='75' y='85' text-anchor='middle' fill='white' font-size='60' font-family='Arial'%3ECNC%3C/text%3E%3C/svg%3E" alt="CNC Logo">
  </div>
  <div class="cover-info">
    <p><strong>Version:</strong> 1.2</p>
    <p><strong>Date:</strong> February 2026</p>
    <p><strong>Project:</strong> FactoryPiCNC / CNCChoco</p>
    <p><strong>Integration:</strong> SAP BTP via Cloud Connector</p>
  </div>
</div>

<!-- Table of Contents -->
<div class="toc">
  <h1>Table of Contents</h1>
  <ul>
    <li><a href="#exec-summary">1. Executive Summary</a></li>
    <li><a href="#functional-spec">2. Functional Specification</a>
      <ul>
        <li><a href="#func-overview">2.1 System Overview</a></li>
        <li><a href="#func-features">2.2 Feature List</a></li>
        <li><a href="#func-user-stories">2.3 User Stories</a></li>
        <li><a href="#func-workflows">2.4 Business Workflows</a></li>
      </ul>
    </li>
    <li><a href="#technical-spec">3. Technical Specification</a>
      <ul>
        <li><a href="#tech-stack">3.1 Technology Stack</a></li>
        <li><a href="#tech-api">3.2 API Specification</a></li>
        <li><a href="#tech-database">3.3 Database Schema</a></li>
        <li><a href="#tech-gcode">3.4 G-code Generation</a></li>
      </ul>
    </li>
    <li><a href="#architecture">4. Architecture</a>
      <ul>
        <li><a href="#arch-system">4.1 System Architecture</a></li>
        <li><a href="#arch-component">4.2 Component Architecture</a></li>
        <li><a href="#arch-data">4.3 Data Flow</a></li>
        <li><a href="#arch-sap">4.4 SAP BTP Integration</a></li>
      </ul>
    </li>
    <li><a href="#user-interface">5. User Interface</a>
      <ul>
        <li><a href="#ui-overview">5.1 UI Overview</a></li>
        <li><a href="#ui-classic">5.2 Classic Web UI</a></li>
        <li><a href="#ui-fiori">5.3 SAP Fiori UI</a></li>
      </ul>
    </li>
    <li><a href="#deployment">6. Deployment</a></li>
    <li><a href="#security">7. Security Considerations</a></li>
    <li><a href="#appendix">8. Appendix</a></li>
  </ul>
</div>

<!-- Executive Summary -->
<h1 id="exec-summary"><span class="section-number">1.</span> Executive Summary</h1>

<p>The CNC Chocolate Engraver is a specialized automation system designed to engrave personalized messages on chocolate bars using a GRBL-controlled CNC router. The system provides a complete end-to-end solution from customer data capture through to physical engraving.</p>

<h3>Key Capabilities</h3>
<ul>
  <li><strong>Job Queue Management</strong> - Create, track, and manage engraving jobs with full lifecycle support</li>
  <li><strong>Real-time Monitoring</strong> - Live dashboard with statistics and status updates</li>
  <li><strong>SAP Integration</strong> - Designed for seamless integration with SAP BTP via Cloud Connector</li>
  <li><strong>Configurable Templates</strong> - Flexible text templates with multiple font options</li>
  <li><strong>Hardware Control</strong> - Direct serial communication with GRBL CNC controllers</li>
</ul>

<h3>Business Value</h3>
<ul>
  <li>Automates personalized chocolate engraving for events and marketing campaigns</li>
  <li>Captures customer data for CRM integration</li>
  <li>Provides real-time visibility into production queue</li>
  <li>Enables remote job submission via SAP BTP</li>
</ul>

<!-- Functional Specification -->
<h1 id="functional-spec"><span class="section-number">2.</span> Functional Specification</h1>

<h2 id="func-overview">2.1 System Overview</h2>

<p>The CNC Chocolate Engraver system consists of three main functional areas:</p>

<table>
  <tr>
    <th>Area</th>
    <th>Description</th>
    <th>Users</th>
  </tr>
  <tr>
    <td><strong>Job Management</strong></td>
    <td>Create, view, edit, and track engraving jobs through their lifecycle</td>
    <td>Operators, Administrators, SAP Users</td>
  </tr>
  <tr>
    <td><strong>Production Control</strong></td>
    <td>Trigger printing, monitor queue, manage CNC connection</td>
    <td>Operators</td>
  </tr>
  <tr>
    <td><strong>Configuration</strong></td>
    <td>Set template text, fonts, bar dimensions, CNC parameters</td>
    <td>Administrators</td>
  </tr>
</table>

<h2 id="func-features">2.2 Feature List</h2>

<h3>2.2.1 Job Management Features</h3>
<table>
  <tr>
    <th>Feature ID</th>
    <th>Feature Name</th>
    <th>Description</th>
    <th>Priority</th>
  </tr>
  <tr>
    <td>JM-001</td>
    <td>Create Job</td>
    <td>Create new engraving job with customer details and messages</td>
    <td>Critical</td>
  </tr>
  <tr>
    <td>JM-002</td>
    <td>View Queue</td>
    <td>Display list of all jobs with filtering by status</td>
    <td>Critical</td>
  </tr>
  <tr>
    <td>JM-003</td>
    <td>Edit Job</td>
    <td>Modify job attributes including status</td>
    <td>High</td>
  </tr>
  <tr>
    <td>JM-004</td>
    <td>Bulk Update</td>
    <td>Select multiple jobs and change status simultaneously</td>
    <td>Medium</td>
  </tr>
  <tr>
    <td>JM-005</td>
    <td>Live Updates</td>
    <td>Auto-refresh queue display every 3 seconds</td>
    <td>High</td>
  </tr>
</table>

<h3>2.2.2 Production Features</h3>
<table>
  <tr>
    <th>Feature ID</th>
    <th>Feature Name</th>
    <th>Description</th>
    <th>Priority</th>
  </tr>
  <tr>
    <td>PR-001</td>
    <td>Print Next</td>
    <td>Trigger printing of next pending job in queue</td>
    <td>Critical</td>
  </tr>
  <tr>
    <td>PR-002</td>
    <td>Print Specific</td>
    <td>Trigger printing of a specific pending job by ID</td>
    <td>High</td>
  </tr>
  <tr>
    <td>PR-003</td>
    <td>CNC Connection</td>
    <td>Connect/disconnect from CNC controller</td>
    <td>Critical</td>
  </tr>
  <tr>
    <td>PR-004</td>
    <td>USB Auto-detect</td>
    <td>Automatically scan for USB serial devices</td>
    <td>High</td>
  </tr>
  <tr>
    <td>PR-005</td>
    <td>Emergency Stop</td>
    <td>Immediate hardware halt via GRBL soft reset (Ctrl-X). Reverts active job to Pending. Machine must be re-homed before resuming.</td>
    <td>Critical</td>
  </tr>
  <tr>
    <td>PR-006</td>
    <td>G-code Script Download</td>
    <td>Generate and download the G-code script for any job as a plain-text file without sending to machine</td>
    <td>Medium</td>
  </tr>
</table>

<h3>2.2.4 Calibration Features</h3>
<table>
  <tr>
    <th>Feature ID</th>
    <th>Feature Name</th>
    <th>Description</th>
    <th>Priority</th>
  </tr>
  <tr>
    <td>CAL-001</td>
    <td>Machine Homing</td>
    <td>Run $H homing cycle to find limit switches and establish machine zero</td>
    <td>Critical</td>
  </tr>
  <tr>
    <td>CAL-002</td>
    <td>Jogging</td>
    <td>Incrementally move the tool along X/Y/Z axes to position over the chocolate bar</td>
    <td>High</td>
  </tr>
  <tr>
    <td>CAL-003</td>
    <td>Set Work Origin</td>
    <td>Store current machine position as the G54 work coordinate origin (0,0,0)</td>
    <td>Critical</td>
  </tr>
  <tr>
    <td>CAL-004</td>
    <td>Dry Run / Bar Trace</td>
    <td>Trace the chocolate bar boundary rectangle at safe Z to verify calibration alignment</td>
    <td>High</td>
  </tr>
  <tr>
    <td>CAL-005</td>
    <td>Job Trace</td>
    <td>Trace the bounding rectangle of a specific job's text layout before engraving</td>
    <td>Medium</td>
  </tr>
  <tr>
    <td>CAL-006</td>
    <td>Alarm Unlock</td>
    <td>Send $X to clear GRBL alarm state after homing failure or emergency stop</td>
    <td>High</td>
  </tr>
</table>

<h3>2.2.3 Statistics Features</h3>
<table>
  <tr>
    <th>Feature ID</th>
    <th>Feature Name</th>
    <th>Description</th>
    <th>Priority</th>
  </tr>
  <tr>
    <td>ST-001</td>
    <td>Total Counts</td>
    <td>Display total jobs, completed, cancelled, lines, characters</td>
    <td>Medium</td>
  </tr>
  <tr>
    <td>ST-002</td>
    <td>Status Chart</td>
    <td>Doughnut chart showing job status distribution</td>
    <td>Medium</td>
  </tr>
  <tr>
    <td>ST-003</td>
    <td>Daily Activity</td>
    <td>Line chart showing jobs created/completed over 30 days</td>
    <td>Low</td>
  </tr>
  <tr>
    <td>ST-004</td>
    <td>Character Chart</td>
    <td>Bar chart showing characters printed per day</td>
    <td>Low</td>
  </tr>
</table>

<h2 id="func-user-stories">2.3 User Stories</h2>

<h4>US-001: Create Job from SAP</h4>
<p><em>As a</em> SAP Fiori user, <em>I want to</em> submit a chocolate engraving job from my SAP screen, <em>so that</em> I can personalize chocolates for event attendees.</p>

<h4>US-002: Monitor Queue</h4>
<p><em>As an</em> operator, <em>I want to</em> see a live-updating queue of all jobs, <em>so that</em> I can monitor production status in real-time.</p>

<h4>US-003: Bulk Cancel</h4>
<p><em>As an</em> administrator, <em>I want to</em> select multiple jobs and cancel them at once, <em>so that</em> I can quickly clear outdated jobs.</p>

<h4>US-004: View Statistics</h4>
<p><em>As a</em> manager, <em>I want to</em> see production statistics and charts, <em>so that</em> I can track performance and throughput.</p>

<h4>US-005: Configure Template</h4>
<p><em>As an</em> administrator, <em>I want to</em> change the template text and fonts, <em>so that</em> I can customize branding for different events.</p>

<h2 id="func-workflows">2.4 Business Workflows</h2>

<h3>2.4.1 Job Lifecycle</h3>

<div class="diagram-placeholder">
  <strong>Job State Diagram</strong><br><br>
  [Created] --&gt; <strong>Pending</strong> --&gt; <strong>Printing</strong> --&gt; <strong>Completed</strong><br>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<br>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v<br>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>Cancelled_by_User</strong> / <strong>Cancelled_by_Admin</strong><br><br>
  <em>Note: Jobs can be moved back to Pending from any status except Printing</em>
</div>

<table>
  <tr>
    <th>Status</th>
    <th>Description</th>
    <th>Allowed Transitions</th>
  </tr>
  <tr>
    <td><strong>Pending</strong></td>
    <td>Job is waiting in queue to be printed</td>
    <td>Printing, Cancelled_by_User, Cancelled_by_Admin</td>
  </tr>
  <tr>
    <td><strong>Printing</strong></td>
    <td>Job is currently being engraved</td>
    <td>Completed (automatic)</td>
  </tr>
  <tr>
    <td><strong>Completed</strong></td>
    <td>Job has been successfully engraved</td>
    <td>Pending (re-print)</td>
  </tr>
  <tr>
    <td><strong>Cancelled_by_User</strong></td>
    <td>Job was cancelled by the customer</td>
    <td>Pending (reinstate)</td>
  </tr>
  <tr>
    <td><strong>Cancelled_by_Admin</strong></td>
    <td>Job was cancelled by an administrator</td>
    <td>Pending (reinstate)</td>
  </tr>
</table>

<h3>2.4.2 Print Workflow</h3>

<ol>
  <li>Operator triggers "Print Next" or selects specific job to print</li>
  <li>System checks if any job is currently printing (only one at a time)</li>
  <li>System retrieves job data and current configuration</li>
  <li>G-code is generated from template + messages using selected fonts</li>
  <li>G-code is sent to GRBL controller via serial port</li>
  <li>Job status is updated to "Printing"</li>
  <li>Upon completion signal, job status is updated to "Completed"</li>
  <li>Statistics are updated (lines printed, characters printed)</li>
</ol>

<!-- Technical Specification -->
<h1 id="technical-spec"><span class="section-number">3.</span> Technical Specification</h1>

<h2 id="tech-stack">3.1 Technology Stack</h2>

<table>
  <tr>
    <th>Layer</th>
    <th>Technology</th>
    <th>Version</th>
    <th>Purpose</th>
  </tr>
  <tr>
    <td>Runtime</td>
    <td>Node.js</td>
    <td>18+</td>
    <td>JavaScript server runtime</td>
  </tr>
  <tr>
    <td>Framework</td>
    <td>Express.js</td>
    <td>5.x</td>
    <td>REST API framework</td>
  </tr>
  <tr>
    <td>Database</td>
    <td>SQLite</td>
    <td>3.x</td>
    <td>Local embedded database</td>
  </tr>
  <tr>
    <td>Serial</td>
    <td>serialport</td>
    <td>13.x</td>
    <td>USB serial communication</td>
  </tr>
  <tr>
    <td>Frontend (Classic)</td>
    <td>Vanilla JS + Chart.js</td>
    <td>4.x</td>
    <td>Web UI with charts</td>
  </tr>
  <tr>
    <td>Frontend (Fiori)</td>
    <td>SAP OpenUI5</td>
    <td>1.120+</td>
    <td>SAP Fiori 3 UI (sap_horizon theme)</td>
  </tr>
  <tr>
    <td>CNC Protocol</td>
    <td>GRBL</td>
    <td>1.1</td>
    <td>CNC motion control</td>
  </tr>
</table>

<h3>3.1.1 File Structure</h3>
<pre>
CNCChoco/
├── cncserver.js        # Main entry point
├── api.js              # REST API endpoints
├── database.js         # SQLite operations
├── config.js           # Configuration management
├── engine.js           # Queue processing & serial
├── gcode.js            # G-code generation
├── fontHershey.js      # Hershey stroke font
├── fontBlock.js        # Block geometric font
├── fontScript.js       # Script cursive font
├── fontCalibri.js      # Calibri font (TrueType-based)
├── fontPristina.js     # Pristina script font
├── fontLogo.js         # Custom logo font
├── public/
│   └── index.html      # Classic Web UI (SPA)
├── fiori/
│   └── webapp/         # SAP Fiori UI5 application
│       ├── Component.js
│       ├── manifest.json
│       ├── controller/
│       ├── view/
│       ├── model/
│       └── i18n/
├── docs/
│   ├── architecture.drawio
│   └── CNC_Chocolate_Engraver_Specification.html
├── package.json
├── CLAUDE.md
└── README.md
</pre>

<h2 id="tech-api">3.2 API Specification</h2>

<h3>3.2.1 Base URL</h3>
<pre>http://localhost:3000/api</pre>

<h3>3.2.2 Job Endpoints</h3>

<h4>POST /api/createjob</h4>
<p>Creates a new engraving job.</p>
<table>
  <tr><th>Parameter</th><th>Type</th><th>Required</th><th>Description</th></tr>
  <tr><td>first_name</td><td>string</td><td>Yes</td><td>Customer first name</td></tr>
  <tr><td>last_name</td><td>string</td><td>Yes</td><td>Customer last name</td></tr>
  <tr><td>email_address</td><td>string</td><td>No</td><td>Customer email</td></tr>
  <tr><td>phone_number</td><td>string</td><td>No</td><td>Customer phone</td></tr>
  <tr><td>question_1</td><td>string</td><td>No</td><td>Survey question 1</td></tr>
  <tr><td>question_2</td><td>string</td><td>No</td><td>Survey question 2</td></tr>
  <tr><td>question_3</td><td>string</td><td>No</td><td>Survey question 3</td></tr>
  <tr><td>best_contact</td><td>string</td><td>No</td><td>Best company contact</td></tr>
  <tr><td>contact_details</td><td>string</td><td>No</td><td>Contact details</td></tr>
  <tr><td>reach_out_next_month</td><td>string</td><td>No</td><td>"yes" or "no"</td></tr>
  <tr><td>message_1</td><td>string</td><td>No</td><td>First message line (max 50 chars)</td></tr>
  <tr><td>message_2</td><td>string</td><td>No</td><td>Second message line (max 50 chars)</td></tr>
  <tr><td>agreement</td><td>string</td><td>No</td><td>"agreed" or "not_agreed"</td></tr>
</table>

<p><strong>Response:</strong></p>
<pre>
{
  "success": true,
  "id": 123,
  "message": "Job created successfully"
}
</pre>

<h4>GET /api/getqueue</h4>
<p>Retrieves all jobs with optional status filter.</p>
<table>
  <tr><th>Query Param</th><th>Type</th><th>Description</th></tr>
  <tr><td>status</td><td>string</td><td>Filter by status (Pending, Printing, Completed, Cancelled_by_User, Cancelled_by_Admin)</td></tr>
</table>

<h4>GET /api/getjob/:id</h4>
<p>Retrieves a single job by ID.</p>

<h4>PATCH /api/updatejobs/:id</h4>
<p>Updates a job's attributes.</p>

<h4>PATCH /api/updatejobs/bulk</h4>
<p>Bulk updates multiple jobs.</p>
<pre>
{
  "ids": [1, 2, 3],
  "status": "Cancelled_by_Admin"
}
</pre>

<h4>GET /api/print</h4>
<p>Triggers printing of the next pending job.</p>

<h4>GET /api/print/:id</h4>
<p>Triggers printing of a specific job by ID. Job must be in Pending status.</p>

<h4>GET /api/script/:id</h4>
<p>Generates and returns the full G-code script for a job as a plain-text file download (<code>Content-Disposition: attachment</code>). Does not send anything to the machine. Useful for inspecting or archiving G-code.</p>

<h3>3.2.3 Configuration Endpoints</h3>

<h4>GET /api/getConfig</h4>
<p>Retrieves all configuration values.</p>

<h4>PATCH /api/updateConfig</h4>
<p>Updates configuration values.</p>
<pre>
{
  "template_text": "KPMG",
  "template_font": "hershey",
  "bar_width": 100
}
</pre>

<h3>3.2.4 Statistics Endpoints</h3>

<h4>GET /api/stats</h4>
<p>Retrieves all statistics including totals, status counts, and daily data.</p>

<h4>GET /api/queue/live</h4>
<p>Retrieves live queue data for real-time updates.</p>

<h3>3.2.5 CNC Control Endpoints</h3>

<h4>GET /api/status</h4>
<p>Gets CNC connection status and available devices. Response includes <code>connected</code>, <code>port</code>, <code>currentJobId</code>, <code>isCalibrated</code>, and <code>lastPosition</code>.</p>

<h4>POST /api/connect</h4>
<p>Connects to a CNC device. Optionally accepts <code>{ "path": "/dev/ttyUSB0" }</code>; if omitted, auto-detects the first USB serial device. On successful connection, applies stored GRBL settings from the database.</p>

<h4>POST /api/disconnect</h4>
<p>Disconnects from the currently connected CNC device.</p>

<h4>POST /api/estop</h4>
<p><strong>Emergency Stop.</strong> Sends the GRBL soft reset byte (0x18 / Ctrl-X), immediately halting all motion and clearing the motion planner buffer. Any job currently in <em>Printing</em> status is reverted to <em>Pending</em>. The machine must be re-homed before resuming normal operation.</p>

<h4>POST /api/command</h4>
<p>Sends a raw G-code command string to the GRBL controller and waits for an <code>ok</code> response.</p>
<pre>{ "gcode": "G0 X10 Y10" }</pre>

<h3>3.2.6 Calibration Endpoints</h3>

<h4>POST /api/calibrate/home</h4>
<p>Runs the GRBL <code>$H</code> homing cycle to find limit switches and establish machine zero. Takes up to 60 seconds. Returns final position.</p>

<h4>POST /api/calibrate/unlock</h4>
<p>Sends <code>$X</code> to clear the GRBL alarm state. Use after a homing failure or after an emergency stop before re-homing.</p>

<h4>POST /api/calibrate/jog</h4>
<p>Sends a GRBL jog command to move the tool incrementally.</p>
<table>
  <tr><th>Parameter</th><th>Type</th><th>Required</th><th>Description</th></tr>
  <tr><td>axis</td><td>string</td><td>Yes</td><td>Axis to jog: X, Y, or Z</td></tr>
  <tr><td>distance</td><td>number</td><td>Yes</td><td>Distance in mm (negative = opposite direction)</td></tr>
  <tr><td>feedRate</td><td>number</td><td>No</td><td>mm/min override; defaults to <code>jog_feed_rate</code> config value</td></tr>
</table>

<h4>POST /api/calibrate/jog/cancel</h4>
<p>Sends the GRBL real-time jog cancel byte (0x85) to immediately stop an active jog move.</p>

<h4>POST /api/calibrate/moveto</h4>
<p>Moves the tool to specific absolute work coordinates (G54). Omit any axis to leave it unchanged.</p>
<pre>{ "x": 50, "y": 20, "z": 5, "feedRate": 500 }</pre>

<h4>GET /api/calibrate/position</h4>
<p>Sends a GRBL real-time status query (<code>?</code>) and returns the current machine position (MPos) and work position (WPos).</p>

<h4>POST /api/calibrate/setorigin</h4>
<p>Sets the current machine position as the G54 work coordinate origin (0,0,0) and stores the offset in GRBL EEPROM. Optional <code>xDelta</code> and <code>yDelta</code> shift the origin by a fixed amount (mm). Requires GRBL <code>$10=1</code> or <code>$10=2</code> for MPos reporting.</p>
<pre>{ "xDelta": 0, "yDelta": 0 }</pre>

<h4>POST /api/calibrate/dryrun</h4>
<p>Traces the chocolate bar boundary rectangle at safe Z height using G54 coordinates. Used to verify that calibration is aligned before engraving. Optionally accepts <code>barWidth</code> and <code>barHeight</code> overrides.</p>

<h4>POST /api/calibrate/tracejob</h4>
<p>Calculates the minimum bounding rectangle of a job's text layout (with 1mm padding) and traces it at safe Z height. If <code>jobId</code> is omitted, uses the next pending job. Returns the traced boundary coordinates.</p>
<pre>{ "jobId": 5 }</pre>

<h2 id="tech-database">3.3 Database Schema</h2>

<h3>3.3.1 Jobs Table</h3>
<pre>
CREATE TABLE jobs (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  first_name TEXT,
  last_name TEXT,
  email_address TEXT,
  phone_number TEXT,
  question_1 TEXT,
  question_2 TEXT,
  question_3 TEXT,
  best_contact TEXT,
  contact_details TEXT,
  reach_out_next_month TEXT,
  message_1 TEXT,
  message_2 TEXT,
  agreement TEXT,
  status TEXT DEFAULT 'Pending',
  created_at INTEGER,
  completed_at INTEGER
);
</pre>

<h3>3.3.2 Config Table</h3>
<pre>
CREATE TABLE config (
  key TEXT PRIMARY KEY,
  value TEXT
);
</pre>

<h3>3.3.3 Statistics Table</h3>
<pre>
CREATE TABLE statistics (
  key TEXT PRIMARY KEY,
  value INTEGER DEFAULT 0
);
</pre>

<h3>3.3.4 Daily Stats Table</h3>
<pre>
CREATE TABLE daily_stats (
  date TEXT PRIMARY KEY,
  jobs_created INTEGER DEFAULT 0,
  jobs_completed INTEGER DEFAULT 0,
  jobs_cancelled INTEGER DEFAULT 0,
  lines_printed INTEGER DEFAULT 0,
  chars_printed INTEGER DEFAULT 0
);
</pre>

<h2 id="tech-gcode">3.4 G-code Generation</h2>

<h3>3.4.1 Output Format</h3>
<p>The system generates standard GRBL-compatible G-code:</p>
<pre>
; CNC Chocolate Engraver
; Job ID: 123
G21 ; Set units to millimeters
G90 ; Absolute positioning
G92 X0 Y0 Z0 ; Set origin
G0 Z5 ; Safe height

; Template: KPMG
G0 Z5
G0 X10.000 Y35.000
G1 Z-0.5 F200
G1 X12.000 Y35.000 F200
...

; End of job
G0 Z5
G0 X0 Y0
M2
</pre>

<h3>3.4.2 Available Fonts</h3>
<table>
  <tr>
    <th>Font</th>
    <th>Style</th>
    <th>Best For</th>
  </tr>
  <tr>
    <td>Hershey</td>
    <td>Single-stroke, classic</td>
    <td>General purpose, readable text</td>
  </tr>
  <tr>
    <td>Block</td>
    <td>Geometric, straight lines</td>
    <td>Modern, clean appearance</td>
  </tr>
  <tr>
    <td>Script</td>
    <td>Cursive, flowing</td>
    <td>Elegant branding, signatures</td>
  </tr>
  <tr>
    <td>Calibri</td>
    <td>TrueType-based, professional</td>
    <td>Corporate branding, modern documents</td>
  </tr>
  <tr>
    <td>Pristina</td>
    <td>Elegant script, refined cursive</td>
    <td>Premium branding, special occasions</td>
  </tr>
  <tr>
    <td>Logo</td>
    <td>Custom logo font</td>
    <td>Company-specific branding</td>
  </tr>
</table>

<div class="note">
  <strong>Recent Font Enhancements (February 2026):</strong>
  <ul>
    <li>Added Calibri and Pristina fonts with vertical positioning adjustments for optimal engraving quality</li>
    <li>Implemented custom logo font for brand-specific engraving</li>
    <li>Enhanced font download functionality - generated G-code can now be downloaded as files</li>
    <li>Improved spacing algorithms for better text layout across all fonts</li>
  </ul>
</div>

<!-- Architecture -->
<h1 id="architecture"><span class="section-number">4.</span> Architecture</h1>

<h2 id="arch-system">4.1 System Architecture</h2>

<div class="diagram-placeholder">
  <strong>System Architecture Diagram</strong><br><br>
  See: <code>docs/architecture.drawio</code> (System Architecture page)<br><br>
  <pre style="text-align: left; display: inline-block;">
┌─────────────────────────────────────────────────────────────────────────────┐
│                              SAP BTP Cloud                                   │
│  ┌──────────────┐    ┌──────────────┐                                       │
│  │  SAP Fiori   │───▶│ BTP Destination│                                      │
│  │  Web App     │    │              │                                       │
│  └──────────────┘    └──────┬───────┘                                       │
└────────────────────────────────┼────────────────────────────────────────────┘
                                 │ HTTPS
                       ┌─────────▼─────────┐
                       │  SAP Cloud        │
                       │  Connector        │
                       └─────────┬─────────┘
                                 │ HTTP :3000
┌────────────────────────────────┼────────────────────────────────────────────┐
│                    On-Premise Network                                        │
│  ┌─────────────────────────────▼─────────────────────────────────┐          │
│  │                     CNC Server (Node.js)                       │          │
│  │  ┌────────────┐  ┌────────────┐  ┌────────────┐               │          │
│  │  │ Express.js │  │  api.js    │  │ database.js│──▶ SQLite     │          │
│  │  │ REST API   │  │ Endpoints  │  │            │               │          │
│  │  └────────────┘  └────────────┘  └────────────┘               │          │
│  │  ┌────────────┐  ┌────────────┐  ┌────────────┐               │          │
│  │  │ engine.js  │  │ gcode.js   │  │  Fonts     │               │          │
│  │  │ Queue Mgmt │──│ Generator  │──│ Hershey... │               │          │
│  │  └─────┬──────┘  └────────────┘  └────────────┘               │          │
│  └────────┼──────────────────────────────────────────────────────┘          │
│           │ Serial /dev/ttyUSB0                                              │
│  ┌────────▼──────┐     ┌────────────┐     ┌────────────┐                    │
│  │ GRBL          │────▶│ CNC Router │────▶│ Chocolate  │                    │
│  │ Controller    │     │ Machine    │     │ Bar        │                    │
│  └───────────────┘     └────────────┘     └────────────┘                    │
└─────────────────────────────────────────────────────────────────────────────┘
  </pre>
</div>

<h2 id="arch-component">4.2 Component Architecture</h2>

<div class="diagram-placeholder">
  <strong>Component Diagram</strong><br><br>
  See: <code>docs/architecture.drawio</code> (Component Diagram page)<br><br>
  <table style="margin: auto; text-align: center;">
    <tr>
      <td colspan="3" style="background: #dae8fc;"><strong>cncserver.js</strong><br>Main Entry Point</td>
    </tr>
    <tr>
      <td style="background: #d5e8d4;">api.js<br>REST Endpoints</td>
      <td style="background: #d5e8d4;">engine.js<br>Queue & Serial</td>
      <td style="background: #d5e8d4;">database.js<br>SQLite ORM</td>
    </tr>
    <tr>
      <td style="background: #fff2cc;">config.js</td>
      <td style="background: #fff2cc;">gcode.js</td>
      <td style="background: #f8cecc;">fonts/*.js</td>
    </tr>
    <tr>
      <td colspan="2" style="background: #e1d5e7;">serialport (npm)</td>
      <td style="background: #e1d5e7;">sqlite3 (npm)</td>
    </tr>
  </table>
</div>

<h3>4.2.1 Component Responsibilities</h3>

<table>
  <tr>
    <th>Component</th>
    <th>Responsibility</th>
    <th>Dependencies</th>
  </tr>
  <tr>
    <td>cncserver.js</td>
    <td>Application bootstrap, middleware setup, graceful shutdown</td>
    <td>express, api, database, engine</td>
  </tr>
  <tr>
    <td>api.js</td>
    <td>Define REST endpoints, request validation, response formatting</td>
    <td>database, config, engine</td>
  </tr>
  <tr>
    <td>engine.js</td>
    <td>Job queue processing, serial communication, USB scanning</td>
    <td>serialport, database, config, gcode</td>
  </tr>
  <tr>
    <td>database.js</td>
    <td>SQLite CRUD operations, schema management</td>
    <td>sqlite3</td>
  </tr>
  <tr>
    <td>config.js</td>
    <td>Configuration validation, type conversion</td>
    <td>database</td>
  </tr>
  <tr>
    <td>gcode.js</td>
    <td>Convert text to G-code using fonts and config</td>
    <td>fontHershey, fontBlock, fontScript</td>
  </tr>
  <tr>
    <td>font*.js</td>
    <td>Define character stroke paths for CNC engraving</td>
    <td>None</td>
  </tr>
</table>

<h2 id="arch-data">4.3 Data Flow</h2>

<div class="diagram-placeholder">
  <strong>Data Flow Diagram</strong><br><br>
  See: <code>docs/architecture.drawio</code> (Data Flow page)<br><br>
  <pre style="text-align: left; display: inline-block;">
User Input ──▶ POST /createjob ──▶ SQLite DB ──▶ Job Queue
                                                    │
GET /print ◀────────────────────────────────────────┘
    │
    ▼
Engine.js ──▶ gcode.js ──▶ Serial Port ──▶ GRBL ──▶ CNC ──▶ Chocolate
    │
    ▼
Update DB ──▶ Statistics ──▶ GET /stats ──▶ Dashboard
  </pre>
</div>

<h2 id="arch-sap">4.4 SAP BTP Integration</h2>

<h3>4.4.1 Integration Architecture</h3>

<p>The CNC Chocolate Engraver integrates with SAP BTP through the following components:</p>

<table>
  <tr>
    <th>Component</th>
    <th>Location</th>
    <th>Purpose</th>
  </tr>
  <tr>
    <td><strong>SAP Fiori App</strong></td>
    <td>SAP BTP Cloud</td>
    <td>User interface for job submission</td>
  </tr>
  <tr>
    <td><strong>SAP BTP Destination</strong></td>
    <td>SAP BTP Cloud</td>
    <td>Route HTTP requests to Cloud Connector</td>
  </tr>
  <tr>
    <td><strong>SAP Cloud Connector</strong></td>
    <td>On-Premise DMZ</td>
    <td>Secure tunnel between cloud and on-premise</td>
  </tr>
  <tr>
    <td><strong>SAP JDK</strong></td>
    <td>On-Premise (same machine)</td>
    <td>Java runtime for Cloud Connector</td>
  </tr>
  <tr>
    <td><strong>CNC Server</strong></td>
    <td>On-Premise</td>
    <td>REST API on port 3000</td>
  </tr>
</table>

<h3>4.4.2 Cloud Connector Configuration</h3>

<div class="note">
  <strong>Cloud Connector Settings:</strong>
  <ul>
    <li><strong>Virtual Host:</strong> cnc-chocolate-engraver</li>
    <li><strong>Virtual Port:</strong> 3000</li>
    <li><strong>Internal Host:</strong> localhost</li>
    <li><strong>Internal Port:</strong> 3000</li>
    <li><strong>Protocol:</strong> HTTP</li>
    <li><strong>Path:</strong> /api (expose only API endpoints)</li>
  </ul>
</div>

<h3>4.4.3 BTP Destination Configuration</h3>

<pre>
Name: CNC_CHOCOLATE_ENGRAVER
Type: HTTP
URL: http://cnc-chocolate-engraver:3000
Proxy Type: OnPremise
Authentication: NoAuthentication
Location ID: [Your Cloud Connector Location ID]
</pre>

<h3>4.4.4 SAP Fiori Integration Example</h3>

<pre>
// SAP UI5 / Fiori example
sap.ui.define([
  "sap/ui/core/mvc/Controller",
  "sap/ui/model/json/JSONModel"
], function(Controller, JSONModel) {
  "use strict";

  return Controller.extend("com.example.ChocolateEngraver", {
    onCreateJob: function() {
      var oData = this.getView().getModel("job").getData();

      $.ajax({
        url: "/destinations/CNC_CHOCOLATE_ENGRAVER/api/createjob",
        method: "POST",
        contentType: "application/json",
        data: JSON.stringify(oData),
        success: function(response) {
          sap.m.MessageToast.show("Job created: #" + response.id);
        },
        error: function(error) {
          sap.m.MessageBox.error("Failed to create job");
        }
      });
    }
  });
});
</pre>

<!-- User Interface -->
<h1 id="user-interface"><span class="section-number">5.</span> User Interface</h1>

<h2 id="ui-overview">5.1 UI Overview</h2>

<p>The CNC Chocolate Engraver system provides two distinct user interfaces to accommodate different usage scenarios and organizational preferences:</p>

<table>
  <tr>
    <th>Interface</th>
    <th>Technology</th>
    <th>Use Case</th>
    <th>Access Path</th>
  </tr>
  <tr>
    <td><strong>Classic Web UI</strong></td>
    <td>Vanilla JavaScript + Chart.js</td>
    <td>Standalone operation, direct management, development/testing</td>
    <td><code>http://localhost:3000/</code></td>
  </tr>
  <tr>
    <td><strong>SAP Fiori UI</strong></td>
    <td>OpenUI5 (sap_horizon theme)</td>
    <td>Enterprise integration, SAP ecosystem consistency, BTP deployment</td>
    <td><code>http://localhost:3000/fiori/</code></td>
  </tr>
</table>

<h2 id="ui-classic">5.2 Classic Web UI</h2>

<h3>5.2.1 Overview</h3>
<p>The classic web interface is a single-page application (SPA) built with vanilla JavaScript and Chart.js. It provides full functionality for managing the CNC chocolate engraver without requiring any SAP infrastructure.</p>

<h3>5.2.2 Features</h3>
<ul>
  <li><strong>Queue Management:</strong> Live-updating job list with status filtering and bulk operations</li>
  <li><strong>Job Creation:</strong> Form-based interface for creating new engraving jobs</li>
  <li><strong>Statistics Dashboard:</strong> Real-time charts showing job status distribution, daily activity, and productivity metrics</li>
  <li><strong>Configuration Panel:</strong> UI for modifying all system parameters (templates, fonts, CNC settings)</li>
  <li><strong>API Documentation:</strong> Embedded Swagger UI for testing and exploring REST endpoints</li>
  <li><strong>CNC Control:</strong> Connection status, device selection, and raw G-code command interface</li>
  <li><strong>Calibration Tool:</strong> Dedicated page for CNC calibration and testing (added February 2026)</li>
</ul>

<h3>5.2.3 Technology Details</h3>
<table>
  <tr>
    <th>Component</th>
    <th>Technology</th>
    <th>Purpose</th>
  </tr>
  <tr>
    <td>Layout</td>
    <td>Custom CSS Grid/Flexbox</td>
    <td>Responsive multi-view interface</td>
  </tr>
  <tr>
    <td>State Management</td>
    <td>Vanilla JavaScript</td>
    <td>Client-side state and polling</td>
  </tr>
  <tr>
    <td>Charting</td>
    <td>Chart.js 4.x</td>
    <td>Doughnut, line, and bar charts</td>
  </tr>
  <tr>
    <td>API Communication</td>
    <td>Fetch API</td>
    <td>REST endpoint integration</td>
  </tr>
  <tr>
    <td>Update Frequency</td>
    <td>3-second polling</td>
    <td>Live queue and statistics updates</td>
  </tr>
</table>

<h2 id="ui-fiori">5.3 SAP Fiori UI</h2>

<h3>5.3.1 Overview</h3>
<p>The SAP Fiori interface is a full-featured OpenUI5 application that follows SAP Fiori 3 design guidelines and the Worklist application pattern. This interface is designed specifically for organizations using SAP BTP and ensures visual and functional consistency with other SAP applications in the enterprise ecosystem.</p>

<h3>5.3.2 Architecture</h3>

<h4>Component-Based MVC Structure</h4>
<p>The Fiori UI follows the standard OpenUI5 Component-based architecture:</p>

<pre>
fiori/webapp/
├── Component.js           # Application component initialization
├── manifest.json          # Application descriptor (metadata, routing, models)
├── index.html            # Bootstrap HTML
├── controller/
│   ├── App.controller.js         # Main app controller
│   ├── Worklist.controller.js    # Job list controller
│   ├── Object.controller.js      # Job detail controller
│   └── CreateJob.controller.js   # Job creation controller
├── view/
│   ├── App.view.xml              # Main shell layout
│   ├── Worklist.view.xml         # Job list with IconTabBar
│   ├── Object.view.xml           # Job detail view
│   └── CreateJob.view.xml        # Job creation dialog
├── model/
│   ├── formatter.js              # Data formatting utilities
│   └── models.js                 # Model initialization
└── i18n/
    └── i18n.properties           # Internationalization texts
</pre>

<h3>5.3.3 Key Features</h3>

<h4>Shell Bar Header</h4>
<ul>
  <li><strong>Application Title:</strong> "CNC Chocolate Engraver"</li>
  <li><strong>CNC Connection Indicator:</strong> Live status badge (Connected/Disconnected) with color coding</li>
  <li><strong>Quick Actions:</strong> Create job button prominently placed</li>
  <li><strong>User Menu:</strong> Settings and help access</li>
</ul>

<h4>IconTabBar Navigation</h4>
<p>Primary navigation uses SAP Fiori IconTabBar pattern for status-based filtering:</p>
<table>
  <tr>
    <th>Tab</th>
    <th>Icon</th>
    <th>Filter</th>
    <th>Live Count Badge</th>
  </tr>
  <tr>
    <td>All Jobs</td>
    <td>sap-icon://task</td>
    <td>No filter</td>
    <td>Total job count</td>
  </tr>
  <tr>
    <td>Pending</td>
    <td>sap-icon://pending</td>
    <td>Status: Pending</td>
    <td>Pending job count</td>
  </tr>
  <tr>
    <td>Printing</td>
    <td>sap-icon://in-progress</td>
    <td>Status: Printing</td>
    <td>Printing job count</td>
  </tr>
  <tr>
    <td>Completed</td>
    <td>sap-icon://complete</td>
    <td>Status: Completed</td>
    <td>Completed job count</td>
  </tr>
  <tr>
    <td>Cancelled</td>
    <td>sap-icon://decline</td>
    <td>Status: Cancelled_*</td>
    <td>Cancelled job count</td>
  </tr>
</table>

<h4>Job Table (sap.m.Table)</h4>
<p>Responsive table with the following columns:</p>
<ul>
  <li><strong>Selection:</strong> Multi-select mode for bulk operations</li>
  <li><strong>Job ID:</strong> Unique identifier with navigation link</li>
  <li><strong>Customer:</strong> First name + Last name</li>
  <li><strong>Messages:</strong> Message 1 and Message 2 preview</li>
  <li><strong>Status:</strong> Visual badge with semantic colors (Error/Warning/Success/Information)</li>
  <li><strong>Created:</strong> Timestamp formatted for local timezone</li>
  <li><strong>Actions:</strong> Per-row action buttons (Print, Edit, Cancel)</li>
</ul>

<h4>Dialogs and Interactions</h4>
<table>
  <tr>
    <th>Dialog</th>
    <th>Trigger</th>
    <th>Functionality</th>
  </tr>
  <tr>
    <td><strong>Create Job</strong></td>
    <td>ShellBar "Create" button</td>
    <td>Full form with all customer fields, messages, and survey questions. Form validation with value state messages.</td>
  </tr>
  <tr>
    <td><strong>Edit Job</strong></td>
    <td>Row action button or detail page</td>
    <td>Modify job attributes including status change. Read-only fields for ID and timestamps.</td>
  </tr>
  <tr>
    <td><strong>View Details</strong></td>
    <td>Click on Job ID</td>
    <td>Object page showing all job information, status history, and available actions.</td>
  </tr>
  <tr>
    <td><strong>Bulk Status Change</strong></td>
    <td>Toolbar button with selected items</td>
    <td>Confirmation dialog for bulk status changes (e.g., Cancel selected jobs).</td>
  </tr>
</table>

<h4>Live Updates</h4>
<ul>
  <li><strong>Polling Interval:</strong> 3 seconds (configurable)</li>
  <li><strong>Updated Elements:</strong>
    <ul>
      <li>IconTabBar count badges</li>
      <li>Table data (new, modified, deleted jobs)</li>
      <li>CNC connection status in ShellBar</li>
      <li>Status badges with animated transitions</li>
    </ul>
  </li>
  <li><strong>Performance Optimization:</strong> Only refreshes visible tab data to minimize network traffic</li>
</ul>

<h4>Bulk Actions</h4>
<p>Available toolbar actions when jobs are selected:</p>
<ul>
  <li><strong>Cancel Selected:</strong> Bulk status change to Cancelled_by_Admin</li>
  <li><strong>Reinstate Selected:</strong> Bulk status change back to Pending</li>
  <li><strong>Export Selected:</strong> Download job data as CSV/Excel</li>
  <li><strong>Delete Selected:</strong> Permanent deletion with confirmation (admin only)</li>
</ul>

<h3>5.3.4 Theming and Visual Design</h3>

<table>
  <tr>
    <th>Element</th>
    <th>Specification</th>
  </tr>
  <tr>
    <td>Theme</td>
    <td>sap_horizon (SAP Fiori 3)</td>
  </tr>
  <tr>
    <td>OpenUI5 Version</td>
    <td>1.120+ (loaded from OpenUI5 CDN)</td>
  </tr>
  <tr>
    <td>Status Colors</td>
    <td>
      Pending: Information (blue)<br>
      Printing: Warning (orange)<br>
      Completed: Success (green)<br>
      Cancelled: Error (red)
    </td>
  </tr>
  <tr>
    <td>Responsive Breakpoints</td>
    <td>Phone, Tablet, Desktop (automatic UI5 responsive behavior)</td>
  </tr>
</table>

<h3>5.3.5 Integration Points</h3>

<h4>REST API Communication</h4>
<p>The Fiori UI communicates with the backend through the same REST API as the classic UI:</p>
<ul>
  <li><strong>Model Type:</strong> sap.ui.model.json.JSONModel for client-side data</li>
  <li><strong>Data Source:</strong> RESTful endpoints at <code>/api/*</code></li>
  <li><strong>Authentication:</strong> Inherits SAP BTP authentication when deployed to BTP</li>
  <li><strong>CORS:</strong> Configured for cross-origin requests when needed</li>
</ul>

<h4>Deployment Options</h4>
<table>
  <tr>
    <th>Deployment Type</th>
    <th>Access URL</th>
    <th>Use Case</th>
  </tr>
  <tr>
    <td>Local Development</td>
    <td><code>http://localhost:3000/fiori/</code></td>
    <td>Testing alongside CNC server</td>
  </tr>
  <tr>
    <td>SAP BTP HTML5 Application Repository</td>
    <td><code>https://[tenant].launchpad.cfapps.[region].hana.ondemand.com</code></td>
    <td>Production SAP BTP deployment with Fiori Launchpad integration</td>
  </tr>
  <tr>
    <td>SAP Work Zone Integration</td>
    <td>Embedded in Work Zone launchpad</td>
    <td>Enterprise portal with single sign-on</td>
  </tr>
</table>

<h3>5.3.6 Internationalization (i18n)</h3>
<p>All user-facing text is externalized to i18n resource bundles for multi-language support:</p>
<pre>
# i18n/i18n.properties (English - default)
appTitle=CNC Chocolate Engraver
appDescription=Manage chocolate engraving jobs

# Column headers
colJobId=Job ID
colCustomer=Customer
colMessages=Messages
colStatus=Status
colCreated=Created

# Status values
statusPending=Pending
statusPrinting=Printing
statusCompleted=Completed
statusCancelled=Cancelled

# Additional languages supported via i18n_de.properties, i18n_es.properties, etc.
</pre>

<h3>5.3.7 Advantages of Fiori UI</h3>

<div class="note">
  <strong>Benefits of SAP Fiori Interface:</strong>
  <ul>
    <li><strong>Consistency:</strong> Matches look-and-feel of other SAP applications in the enterprise</li>
    <li><strong>Accessibility:</strong> Built-in ARIA support and keyboard navigation</li>
    <li><strong>Responsive:</strong> Automatic adaptation to phone, tablet, and desktop</li>
    <li><strong>Enterprise Features:</strong> Role-based UI adaptation, personalization, theming</li>
    <li><strong>SAP Integration:</strong> Seamless embedding in Fiori Launchpad and Work Zone</li>
    <li><strong>Standards Compliance:</strong> Follows SAP Fiori Design Guidelines</li>
    <li><strong>Maintainability:</strong> Component-based architecture with clear separation of concerns</li>
  </ul>
</div>

<!-- Deployment -->
<h1 id="deployment"><span class="section-number">6.</span> Deployment</h1>

<h2>5.1 Hardware Requirements</h2>

<table>
  <tr>
    <th>Component</th>
    <th>Requirement</th>
  </tr>
  <tr>
    <td>Computer</td>
    <td>Linux system (Raspberry Pi, Ubuntu, etc.)</td>
  </tr>
  <tr>
    <td>Memory</td>
    <td>512MB minimum, 1GB recommended</td>
  </tr>
  <tr>
    <td>Storage</td>
    <td>100MB for application, additional for database</td>
  </tr>
  <tr>
    <td>USB Port</td>
    <td>USB 2.0 or higher for CNC connection</td>
  </tr>
  <tr>
    <td>Network</td>
    <td>Ethernet or WiFi for SAP integration</td>
  </tr>
</table>

<h2>5.2 Software Requirements</h2>

<table>
  <tr>
    <th>Software</th>
    <th>Version</th>
  </tr>
  <tr>
    <td>Node.js</td>
    <td>18.x or higher</td>
  </tr>
  <tr>
    <td>npm</td>
    <td>9.x or higher</td>
  </tr>
  <tr>
    <td>SAP Cloud Connector</td>
    <td>2.x (for SAP integration)</td>
  </tr>
  <tr>
    <td>SAP JDK</td>
    <td>11 or higher (for Cloud Connector)</td>
  </tr>
</table>

<h2>5.3 Installation Steps</h2>

<pre>
# 1. Clone repository
git clone &lt;repository&gt;
cd CNCChoco

# 2. Install dependencies
npm install

# 3. Start server
npm start

# 4. Access web interface
# Open http://localhost:3000 in browser
</pre>

<h2>5.4 Running as a Service</h2>

<pre>
# Create systemd service file
sudo nano /etc/systemd/system/cnc-chocolate.service

[Unit]
Description=CNC Chocolate Engraver
After=network.target

[Service]
Type=simple
User=cnccomputer
WorkingDirectory=/home/cnccomputer/CNCChoco
ExecStart=/usr/bin/node cncserver.js
Restart=on-failure

[Install]
WantedBy=multi-user.target

# Enable and start
sudo systemctl enable cnc-chocolate
sudo systemctl start cnc-chocolate
</pre>

<!-- Security -->
<h1 id="security"><span class="section-number">7.</span> Security Considerations</h1>

<h2>6.1 Current Implementation</h2>

<div class="warning">
  <strong>Note:</strong> The current implementation does not include authentication. It is intended for use within a secured network environment, accessed through SAP Cloud Connector which provides security at the network level.
</div>

<h2>6.2 Network Security</h2>

<ul>
  <li><strong>Firewall:</strong> Only port 3000 should be accessible, and only from Cloud Connector</li>
  <li><strong>Cloud Connector:</strong> Provides secure tunnel with TLS encryption</li>
  <li><strong>No External Access:</strong> CNC server should not be directly accessible from internet</li>
</ul>

<h2>6.3 Recommendations for Production</h2>

<ul>
  <li>Implement API key or JWT authentication</li>
  <li>Add rate limiting to prevent abuse</li>
  <li>Enable HTTPS with valid certificates</li>
  <li>Implement input validation for G-code commands</li>
  <li>Add audit logging for all operations</li>
  <li>Regular database backups</li>
</ul>

<!-- Appendix -->
<h1 id="appendix"><span class="section-number">8.</span> Appendix</h1>

<h2>8.1 Configuration Reference</h2>

<table>
  <tr>
    <th>Key</th>
    <th>Type</th>
    <th>Default</th>
    <th>Description</th>
  </tr>
  <tr><td>template_text</td><td>string</td><td>"KPMG"</td><td>Template text to engrave</td></tr>
  <tr><td>template_font</td><td>enum</td><td>"hershey"</td><td>hershey, block, or script</td></tr>
  <tr><td>template_font_size</td><td>number</td><td>12</td><td>Template font size (mm)</td></tr>
  <tr><td>template_alignment</td><td>enum</td><td>"centered"</td><td>left, centered, or right</td></tr>
  <tr><td>bar_width</td><td>number</td><td>100</td><td>Chocolate bar width (mm)</td></tr>
  <tr><td>bar_height</td><td>number</td><td>40</td><td>Chocolate bar height (mm)</td></tr>
  <tr><td>message_font</td><td>enum</td><td>"hershey"</td><td>Message font</td></tr>
  <tr><td>message_font_size_1_line</td><td>number</td><td>10</td><td>Font size for single message</td></tr>
  <tr><td>message_font_size_2_lines</td><td>number</td><td>7</td><td>Font size for two messages</td></tr>
  <tr><td>message_alignment</td><td>enum</td><td>"centered"</td><td>left or centered</td></tr>
  <tr><td>gap_template_to_message</td><td>number</td><td>5</td><td>Gap between template and messages (mm)</td></tr>
  <tr><td>gap_between_lines</td><td>number</td><td>3</td><td>Gap between message lines (mm)</td></tr>
  <tr><td>z_safe_height</td><td>number</td><td>5</td><td>Z height for travel moves (mm, 0–50)</td></tr>
  <tr><td>z_engrave_depth</td><td>number</td><td>-0.5</td><td>Z depth for engraving (mm, -10–0)</td></tr>
  <tr><td>feed_rate</td><td>number</td><td>200</td><td>Engraving feed rate (mm/min, 10–2000)</td></tr>
  <tr><td>jog_feed_rate</td><td>number</td><td>500</td><td>Jogging feed rate used by calibration moves (mm/min, 10–5000)</td></tr>
  <tr><td>normalize_glyph_z</td><td>boolean</td><td>false</td><td>When true, overrides Z moves inside each glyph to use z_engrave_depth</td></tr>
  <tr><td>normalize_glyph_feed</td><td>boolean</td><td>false</td><td>When true, overrides feed rates inside each glyph to use feed_rate</td></tr>
  <tr><td>decimals</td><td>integer</td><td>3</td><td>Decimal places used for X/Y/Z values in G-code output (0–8)</td></tr>
  <tr><td>use_g54_calibration</td><td>boolean</td><td>true</td><td>When true, printing uses G54 work coordinate offset set via calibration. When false, uses G92 origin reset.</td></tr>
  <tr><td>spindle_enabled</td><td>boolean</td><td>false</td><td>When true, inserts M3/M5 spindle on/off commands around engraving moves</td></tr>
  <tr><td>spindle_speed</td><td>number</td><td>500</td><td>Spindle speed S value used in M3 command (0–1000)</td></tr>
</table>

<h2>8.2 Error Codes</h2>

<table>
  <tr>
    <th>HTTP Code</th>
    <th>Meaning</th>
    <th>Common Causes</th>
  </tr>
  <tr><td>200</td><td>Success</td><td>Request completed successfully</td></tr>
  <tr><td>400</td><td>Bad Request</td><td>Invalid parameters, missing required fields</td></tr>
  <tr><td>404</td><td>Not Found</td><td>Job ID not found</td></tr>
  <tr><td>500</td><td>Server Error</td><td>Database error, serial port error</td></tr>
</table>

<h2>8.3 GRBL Commands Reference</h2>

<table>
  <tr>
    <th>Command</th>
    <th>Description</th>
  </tr>
  <tr><td>G0</td><td>Rapid move (travel at max speed)</td></tr>
  <tr><td>G1</td><td>Linear move (controlled feed rate, used for engraving)</td></tr>
  <tr><td>G21</td><td>Set units to millimeters</td></tr>
  <tr><td>G90</td><td>Absolute positioning mode</td></tr>
  <tr><td>G54</td><td>Use work coordinate system 1 (set via calibration)</td></tr>
  <tr><td>G92</td><td>Set position offset (legacy origin definition)</td></tr>
  <tr><td>G10 L2 P1</td><td>Set G54 work coordinate offset in EEPROM</td></tr>
  <tr><td>M3 S&lt;n&gt;</td><td>Spindle on at speed S (used when spindle_enabled = true)</td></tr>
  <tr><td>M5</td><td>Spindle off</td></tr>
  <tr><td>M2</td><td>End program</td></tr>
  <tr><td>$H</td><td>Run homing cycle (finds limit switches)</td></tr>
  <tr><td>$X</td><td>Kill alarm lock (used after homing failure or e-stop)</td></tr>
  <tr><td>?</td><td>Real-time status query (returns MPos, WPos, state)</td></tr>
  <tr><td>0x18 (Ctrl-X)</td><td>Soft reset — immediately halts all motion and clears buffers</td></tr>
  <tr><td>0x85</td><td>Jog cancel — stops an active jog move without full reset</td></tr>
</table>

<h2>8.4 Document History</h2>

<table>
  <tr>
    <th>Version</th>
    <th>Date</th>
    <th>Author</th>
    <th>Changes</th>
  </tr>
  <tr>
    <td>1.0</td>
    <td>January 2026</td>
    <td>Claude</td>
    <td>Initial release</td>
  </tr>
  <tr>
    <td>1.1</td>
    <td>February 2026</td>
    <td>Claude</td>
    <td>Added SAP Fiori UI section, updated fonts (Calibri, Pristina, Logo), added calibration feature, enhanced file structure</td>
  </tr>
  <tr>
    <td>1.2</td>
    <td>February 2026</td>
    <td>Claude</td>
    <td>Added full Calibration API section (3.2.6), documented POST /api/estop and GET /api/script/:id, added 7 new config keys (jog_feed_rate, normalize_glyph_z, normalize_glyph_feed, decimals, use_g54_calibration, spindle_enabled, spindle_speed), expanded GRBL commands reference, added calibration feature list (CAL-001 to CAL-006)</td>
  </tr>
</table>

<h2>8.5 Development Prompts</h2>

<p>This section documents the chronological progression of user requirements that defined the CNC Chocolate Engraver project. Each entry includes the original prompt and a refactored version that clarifies intent and improves technical precision.</p>

<div class="note">
  <strong>Purpose:</strong> This appendix serves as a development history, capturing the evolution of project requirements and providing context for design decisions throughout the specification.
</div>

<h3>8.5.1 Prompt #1: Initial Prox Engine Requirements</h3>
<p><strong>Date:</strong> January 2026<br>
<strong>Context:</strong> Project inception and core architecture definition</p>

<h4>Original Prompt:</h4>
<div style="background-color: #f4f4f4; padding: 15px; border-left: 4px solid #999; margin: 10px 0;">
Build a "prox engine" for CNC chocolate engraver. APIs for web data integration. Database storage for jobs. Job queue management. G-code generation from templates/messages. Serial communication to GRBL CNC.
</div>

<h4>Refactored Prompt:</h4>
<div style="background-color: #e8f6f3; padding: 15px; border-left: 4px solid #1abc9c; margin: 10px 0;">
<strong>Objective:</strong> Develop a processing engine ("prox engine") for a CNC chocolate engraver system that handles the complete workflow from job creation to physical engraving.

<strong>Required Capabilities:</strong>
<ol>
  <li><strong>Web API Integration:</strong> Implement RESTful API endpoints for external systems to submit and manage engraving jobs.</li>
  <li><strong>Database Persistence:</strong> Establish database storage to maintain job records, configuration settings, and operational state.</li>
  <li><strong>Queue Management:</strong> Create a job queue system that manages the lifecycle of engraving jobs from submission through completion.</li>
  <li><strong>G-code Generation:</strong> Develop functionality to generate GRBL-compatible G-code from predefined templates combined with user-provided messages.</li>
  <li><strong>CNC Communication:</strong> Implement serial port communication to interface with GRBL-based CNC controllers for executing engraving operations.</li>
</ol>

<strong>Expected Outcome:</strong> A fully functional backend system that accepts job requests via API, stores them persistently, generates appropriate G-code, and controls physical hardware to execute engravings.
</div>

<h3>8.5.2 Prompt #2: API Field Definitions</h3>
<p><strong>Date:</strong> January 2026<br>
<strong>Context:</strong> Detailed API schema specification for job management</p>

<h4>Original Prompt:</h4>
<div style="background-color: #f4f4f4; padding: 15px; border-left: 4px solid #999; margin: 10px 0;">
Create Job API with fields: First Name, Last Name, Email Address, Phone Number, Question 1-3, Best Contact, Contact Details, Reach Out Next Month, Message 1, Message 2, Agreement. GetJobs, UpdateJobs, Print API endpoints. Status values: Pending, Printing, Completed, Cancelled_by_User, Cancelled_by_Admin.
</div>

<h4>Refactored Prompt:</h4>
<div style="background-color: #e8f6f3; padding: 15px; border-left: 4px solid #1abc9c; margin: 10px 0;">
<strong>Objective:</strong> Define the complete API specification for job management, including data schema, endpoints, and status workflow.

<strong>Job Data Schema - Required Fields:</strong>
<table style="font-size: 9pt; margin-top: 10px;">
  <tr><th>Field Name</th><th>Data Type</th><th>Purpose</th></tr>
  <tr><td>first_name</td><td>string</td><td>Customer first name</td></tr>
  <tr><td>last_name</td><td>string</td><td>Customer last name</td></tr>
  <tr><td>email_address</td><td>string</td><td>Customer email address</td></tr>
  <tr><td>phone_number</td><td>string</td><td>Customer phone number</td></tr>
  <tr><td>question_1</td><td>string</td><td>Survey question 1 response</td></tr>
  <tr><td>question_2</td><td>string</td><td>Survey question 2 response</td></tr>
  <tr><td>question_3</td><td>string</td><td>Survey question 3 response</td></tr>
  <tr><td>best_contact</td><td>string</td><td>Best company contact method</td></tr>
  <tr><td>contact_details</td><td>string</td><td>Additional contact information</td></tr>
  <tr><td>reach_out_next_month</td><td>string</td><td>Customer consent for future contact</td></tr>
  <tr><td>message_1</td><td>string</td><td>First line of personalized message</td></tr>
  <tr><td>message_2</td><td>string</td><td>Second line of personalized message</td></tr>
  <tr><td>agreement</td><td>string</td><td>Terms and conditions agreement status</td></tr>
</table>

<strong>Required API Endpoints:</strong>
<ol>
  <li><strong>CreateJob:</strong> POST endpoint to create new engraving jobs with the schema defined above</li>
  <li><strong>GetJobs:</strong> GET endpoint to retrieve job queue with optional filtering by status</li>
  <li><strong>UpdateJobs:</strong> PATCH endpoint to modify job attributes and status</li>
  <li><strong>Print:</strong> GET/POST endpoint to trigger engraving execution for pending jobs</li>
</ol>

<strong>Job Status State Machine:</strong><br>
Define the following status values and their valid transitions:
<ul>
  <li><strong>Pending:</strong> Job created and awaiting execution</li>
  <li><strong>Printing:</strong> Job currently being engraved</li>
  <li><strong>Completed:</strong> Job successfully engraved</li>
  <li><strong>Cancelled_by_User:</strong> Job cancelled by customer request</li>
  <li><strong>Cancelled_by_Admin:</strong> Job cancelled by system administrator</li>
</ul>
</div>

<h3>8.5.3 Prompt #3: Template and Configuration Requirements</h3>
<p><strong>Date:</strong> January 2026<br>
<strong>Context:</strong> Configuration system and template customization capabilities</p>

<h4>Original Prompt:</h4>
<div style="background-color: #f4f4f4; padding: 15px; border-left: 4px solid #999; margin: 10px 0;">
SQLite database. Template stored in DB with config screen. Fonts: Hershey, Block, Script. Bar size: 40mm x 100mm. Configurable: template text, fonts, sizes, alignments, gaps, Z heights, feed rates. USB device auto-scan.
</div>

<h4>Refactored Prompt:</h4>
<div style="background-color: #e8f6f3; padding: 15px; border-left: 4px solid #1abc9c; margin: 10px 0;">
<strong>Objective:</strong> Implement a flexible configuration system that allows administrators to customize engraving parameters without code modifications.

<strong>Database Technology:</strong>
<ul>
  <li>Use SQLite for embedded database storage (no external database server required)</li>
  <li>Store all configuration values in a dedicated configuration table</li>
  <li>Implement configuration versioning and validation</li>
</ul>

<strong>Font Library Requirements:</strong><br>
Implement three distinct stroke-based fonts suitable for CNC engraving:
<ol>
  <li><strong>Hershey Font:</strong> Classic single-stroke font for general-purpose text</li>
  <li><strong>Block Font:</strong> Geometric font with straight lines for modern aesthetic</li>
  <li><strong>Script Font:</strong> Cursive/flowing font for elegant branding</li>
</ol>

<strong>Physical Constraints:</strong>
<ul>
  <li>Standard chocolate bar dimensions: 40mm height × 100mm width</li>
  <li>All coordinate calculations must respect these boundaries</li>
</ul>

<strong>Configurable Parameters:</strong><br>
Create a configuration interface allowing modification of:
<ul>
  <li><strong>Template Settings:</strong> Template text content, font selection, font size, horizontal alignment (left/center/right)</li>
  <li><strong>Message Settings:</strong> Message font selection, font sizes for single-line vs. two-line messages, alignment</li>
  <li><strong>Layout Parameters:</strong> Gap between template and messages, gap between message lines</li>
  <li><strong>CNC Parameters:</strong> Z-axis safe height for travel moves, Z-axis engraving depth (negative value), feed rate for engraving operations (mm/min)</li>
</ul>

<strong>Hardware Detection:</strong>
<ul>
  <li>Implement automatic USB device scanning to detect available serial ports</li>
  <li>Display available devices to user for selection</li>
  <li>Handle connection/disconnection events gracefully</li>
</ul>
</div>

<h3>8.5.4 Prompt #4: Statistics and UI Enhancement Requests</h3>
<p><strong>Date:</strong> January 2026<br>
<strong>Context:</strong> Dashboard enhancements and real-time monitoring capabilities</p>

<h4>Original Prompt:</h4>
<div style="background-color: #f4f4f4; padding: 15px; border-left: 4px solid #999; margin: 10px 0;">
Statistics page with graphs (Chart.js). Bulk selection and status change. Per-job print buttons (disabled when another job printing). Live updates (3-second polling).
</div>

<h4>Refactored Prompt:</h4>
<div style="background-color: #e8f6f3; padding: 15px; border-left: 4px solid #1abc9c; margin: 10px 0;">
<strong>Objective:</strong> Enhance the web interface with real-time monitoring, bulk operations, and visual analytics to improve operational visibility and efficiency.

<strong>Statistics Dashboard Requirements:</strong>
<ol>
  <li><strong>Visualization Library:</strong> Integrate Chart.js for creating interactive, responsive charts</li>
  <li><strong>Key Metrics to Display:</strong>
    <ul>
      <li>Total jobs created, completed, cancelled</li>
      <li>Total lines engraved and characters printed</li>
      <li>Current queue depth by status</li>
    </ul>
  </li>
  <li><strong>Chart Types Required:</strong>
    <ul>
      <li>Doughnut chart: Job status distribution (Pending, Printing, Completed, Cancelled)</li>
      <li>Line chart: Daily activity showing jobs created vs. completed over 30-day period</li>
      <li>Bar chart: Characters printed per day for productivity tracking</li>
    </ul>
  </li>
</ol>

<strong>Bulk Operations Feature:</strong>
<ul>
  <li>Implement checkbox selection for multiple jobs in the queue view</li>
  <li>Provide "Select All" and "Deselect All" functionality</li>
  <li>Enable bulk status changes for selected jobs (e.g., bulk cancel, bulk reinstate)</li>
  <li>Display confirmation dialog before executing bulk operations</li>
</ul>

<strong>Per-Job Print Control:</strong>
<ul>
  <li>Add individual "Print" button for each job in the queue</li>
  <li>Implement mutex logic: disable all print buttons when any job is actively printing</li>
  <li>Re-enable buttons automatically when printing completes</li>
  <li>Provide visual feedback for the currently printing job</li>
</ul>

<strong>Live Updates Implementation:</strong>
<ul>
  <li>Implement client-side polling mechanism with 3-second interval</li>
  <li>Update queue display without full page refresh</li>
  <li>Update statistics and charts in real-time</li>
  <li>Highlight recently changed jobs for operator awareness</li>
  <li>Minimize network overhead by only fetching changed data when possible</li>
</ul>
</div>

<h3>8.5.5 Prompt #5: SAP BTP Integration</h3>
<p><strong>Date:</strong> January 2026<br>
<strong>Context:</strong> Enterprise integration requirements for SAP Business Technology Platform</p>

<h4>Original Prompt:</h4>
<div style="background-color: #f4f4f4; padding: 15px; border-left: 4px solid #999; margin: 10px 0;">
Integration via SAP Cloud Connector. SAP JDK on same machine as CNC server. REST API accessible on port 3000.
</div>

<h4>Refactored Prompt:</h4>
<div style="background-color: #e8f6f3; padding: 15px; border-left: 4px solid #1abc9c; margin: 10px 0;">
<strong>Objective:</strong> Enable secure integration with SAP Business Technology Platform (BTP) to allow SAP Fiori applications to submit and manage chocolate engraving jobs remotely.

<strong>Integration Architecture:</strong>
<ol>
  <li><strong>SAP Cloud Connector:</strong>
    <ul>
      <li>Deploy SAP Cloud Connector as secure tunnel between SAP BTP Cloud and on-premise CNC server</li>
      <li>Configure virtual host mapping for the CNC server endpoints</li>
      <li>Expose only /api paths to maintain security boundary</li>
    </ul>
  </li>
  <li><strong>Java Runtime Requirements:</strong>
    <ul>
      <li>Install SAP JDK on the same machine hosting the CNC server</li>
      <li>Ensure Java version compatibility with Cloud Connector requirements</li>
      <li>Configure Java environment variables appropriately</li>
    </ul>
  </li>
  <li><strong>REST API Exposure:</strong>
    <ul>
      <li>Ensure CNC server REST API listens on port 3000</li>
      <li>Configure API to accept requests from Cloud Connector proxy</li>
      <li>Maintain HTTP protocol for internal network communication (TLS handled by Cloud Connector)</li>
    </ul>
  </li>
</ol>

<strong>Network Configuration:</strong>
<ul>
  <li>CNC server must be accessible from Cloud Connector on localhost:3000</li>
  <li>No direct internet exposure required or recommended</li>
  <li>All external access routed through SAP BTP security layer</li>
</ul>

<strong>Expected Integration Flow:</strong><br>
SAP Fiori App (BTP Cloud) → BTP Destination → Cloud Connector → CNC Server (port 3000)
</div>

<h3>8.5.6 Prompt #6: Documentation Requirements</h3>
<p><strong>Date:</strong> January 2026<br>
<strong>Context:</strong> Technical documentation and API specification delivery</p>

<h4>Original Prompt:</h4>
<div style="background-color: #f4f4f4; padding: 15px; border-left: 4px solid #999; margin: 10px 0;">
Swagger/OpenAPI documentation with testable UI. Specification document with draw.io diagrams.
</div>

<h4>Refactored Prompt:</h4>
<div style="background-color: #e8f6f3; padding: 15px; border-left: 4px solid #1abc9c; margin: 10px 0;">
<strong>Objective:</strong> Provide comprehensive technical documentation to support development, integration, and maintenance of the CNC Chocolate Engraver system.

<strong>Interactive API Documentation:</strong>
<ol>
  <li><strong>Swagger/OpenAPI Specification:</strong>
    <ul>
      <li>Create complete OpenAPI 3.0 specification document for all REST endpoints</li>
      <li>Include detailed parameter descriptions, request/response schemas, and example payloads</li>
      <li>Document all status codes and error responses</li>
    </ul>
  </li>
  <li><strong>Swagger UI Integration:</strong>
    <ul>
      <li>Embed Swagger UI within the application for interactive API exploration</li>
      <li>Enable "Try it out" functionality for testing endpoints directly from documentation</li>
      <li>Provide authentication testing capabilities if applicable</li>
    </ul>
  </li>
</ol>

<strong>Technical Specification Document:</strong>
<ol>
  <li><strong>Architecture Diagrams:</strong>
    <ul>
      <li>Create draw.io diagrams illustrating system architecture, component relationships, and data flows</li>
      <li>Include separate diagrams for: System Architecture, Component Architecture, Data Flow, SAP BTP Integration</li>
      <li>Export diagrams in both editable (.drawio) and image formats</li>
    </ul>
  </li>
  <li><strong>Document Structure:</strong>
    <ul>
      <li>Produce a professional HTML specification document with proper sectioning</li>
      <li>Include: Executive Summary, Functional Specification, Technical Specification, Architecture, Deployment Guide, Security Considerations</li>
      <li>Provide Table of Contents with navigation links</li>
      <li>Format for both screen viewing and print output</li>
    </ul>
  </li>
</ol>

<strong>Documentation Deliverables:</strong>
<ul>
  <li>OpenAPI specification file (YAML or JSON)</li>
  <li>Embedded Swagger UI accessible via web interface</li>
  <li>HTML specification document with embedded CSS</li>
  <li>draw.io architecture diagram file</li>
  <li>Exported diagram images (PNG/SVG)</li>
</ul>
</div>

<h3>8.5.7 Prompt #7: SAP Fiori UI Development</h3>
<p><strong>Date:</strong> February 2026<br>
<strong>Context:</strong> Request for SAP Fiori-based frontend to maintain consistency with SAP ecosystem</p>

<h4>Original Prompt:</h4>
<div style="background-color: #f4f4f4; padding: 15px; border-left: 4px solid #999; margin: 10px 0;">
I need a fiori based front end page as well as the current one. Could you draft one for me? We intend to integrate this into our SAP ecosystem and would prefer to maintain the Fiori based aesthetic across apps
</div>

<h4>Refactored Prompt:</h4>
<div style="background-color: #e8f6f3; padding: 15px; border-left: 4px solid #1abc9c; margin: 10px 0;">
<strong>Objective:</strong> Develop a SAP Fiori-based user interface that runs alongside the existing classic web UI, providing a consistent user experience for organizations using SAP Business Technology Platform.

<strong>Requirements:</strong>
<ol>
  <li><strong>Dual UI Strategy:</strong>
    <ul>
      <li>Maintain the existing classic web UI at <code>/</code> for standalone usage and development</li>
      <li>Create a new SAP Fiori UI at <code>/fiori/</code> for enterprise SAP ecosystem integration</li>
      <li>Both UIs should consume the same REST API endpoints</li>
      <li>Ensure feature parity between both interfaces</li>
    </ul>
  </li>
  <li><strong>Technology Stack:</strong>
    <ul>
      <li>Use SAP OpenUI5 framework (version 1.120 or higher)</li>
      <li>Apply the sap_horizon theme (SAP Fiori 3 design)</li>
      <li>Load OpenUI5 from the official CDN for ease of deployment</li>
      <li>Follow Component-based MVC architecture pattern</li>
    </ul>
  </li>
  <li><strong>Application Pattern:</strong>
    <ul>
      <li>Implement the SAP Fiori Worklist application pattern</li>
      <li>Create a master-detail layout with job list and detail views</li>
      <li>Include proper routing for deep-linking support</li>
      <li>Implement responsive design for phone, tablet, and desktop</li>
    </ul>
  </li>
  <li><strong>Core Functionality:</strong>
    <ul>
      <li>ShellBar header with application title and CNC connection status indicator</li>
      <li>IconTabBar for filtering jobs by status with live count badges</li>
      <li>Responsive table (sap.m.Table) displaying job queue with all relevant information</li>
      <li>Dialogs for creating, editing, and viewing job details</li>
      <li>Bulk action support with multi-select capability</li>
      <li>Per-row action buttons for individual job operations (Print, Edit, Cancel)</li>
    </ul>
  </li>
  <li><strong>Real-time Updates:</strong>
    <ul>
      <li>Implement 3-second polling interval (consistent with classic UI)</li>
      <li>Update IconTabBar count badges in real-time</li>
      <li>Refresh table data without disrupting user interactions</li>
      <li>Update CNC connection status indicator automatically</li>
    </ul>
  </li>
  <li><strong>Visual Design Requirements:</strong>
    <ul>
      <li>Use SAP Fiori semantic colors for status badges (Information, Warning, Success, Error)</li>
      <li>Follow SAP Fiori Design Guidelines for layout, spacing, and typography</li>
      <li>Implement proper ARIA labels for accessibility</li>
      <li>Ensure visual consistency with other SAP applications in the enterprise</li>
    </ul>
  </li>
  <li><strong>File Structure:</strong>
    <ul>
      <li>Create <code>fiori/webapp/</code> directory following standard OpenUI5 project structure</li>
      <li>Include Component.js, manifest.json (application descriptor)</li>
      <li>Separate controllers, views (XML), models, and i18n resources</li>
      <li>Follow naming conventions and best practices for OpenUI5 applications</li>
    </ul>
  </li>
</ol>

<strong>Expected Outcome:</strong> A fully functional SAP Fiori UI5 application that provides the same capabilities as the classic UI but with SAP Fiori design language, making it suitable for deployment to SAP BTP and integration with Fiori Launchpad and SAP Work Zone.
</div>

<h3>8.5.8 Prompt #8: Documentation Update Request</h3>
<p><strong>Date:</strong> February 2026<br>
<strong>Context:</strong> Request to update technical specification document to reflect new Fiori UI and recent features</p>

<h4>Original Prompt:</h4>
<div style="background-color: #f4f4f4; padding: 15px; border-left: 4px solid #999; margin: 10px 0;">
Could you update the docs page on the index site to reflect new changes?
</div>

<h4>Refactored Prompt:</h4>
<div style="background-color: #e8f6f3; padding: 15px; border-left: 4px solid #1abc9c; margin: 10px 0;">
<strong>Objective:</strong> Update the technical specification document (<code>CNC_Chocolate_Engraver_Specification.html</code>) to accurately reflect all recent system enhancements and new features.

<strong>Required Updates:</strong>
<ol>
  <li><strong>Version and Date:</strong>
    <ul>
      <li>Increment document version from 1.0 to 1.1</li>
      <li>Update "Last Updated" date to February 2026</li>
      <li>Add entry to Document History table describing changes</li>
    </ul>
  </li>
  <li><strong>New User Interface Section:</strong>
    <ul>
      <li>Add a new major section (Section 5) titled "User Interface"</li>
      <li>Document both Classic Web UI and SAP Fiori UI interfaces</li>
      <li>Include comparison table showing use cases and access paths for each UI</li>
      <li>Provide detailed architecture documentation for Fiori UI including:
        <ul>
          <li>Component-based MVC structure</li>
          <li>IconTabBar navigation pattern</li>
          <li>Table structure and columns</li>
          <li>Dialog interactions</li>
          <li>Live update mechanism</li>
          <li>Bulk action capabilities</li>
          <li>Theming and visual design specifications</li>
          <li>Deployment options (local, SAP BTP, Work Zone)</li>
          <li>Internationalization support</li>
        </ul>
      </li>
    </ul>
  </li>
  <li><strong>Technology Stack Updates:</strong>
    <ul>
      <li>Add OpenUI5 to the technology stack table with version 1.120+ and sap_horizon theme</li>
      <li>Distinguish between "Frontend (Classic)" and "Frontend (Fiori)"</li>
    </ul>
  </li>
  <li><strong>File Structure Updates:</strong>
    <ul>
      <li>Update the file structure diagram to include new font files (fontCalibri.js, fontPristina.js, fontLogo.js)</li>
      <li>Add the <code>fiori/webapp/</code> directory structure with subdirectories (controller, view, model, i18n)</li>
      <li>Show Component.js and manifest.json files</li>
    </ul>
  </li>
  <li><strong>Font Library Expansion:</strong>
    <ul>
      <li>Expand the "Available Fonts" table to include three new fonts:
        <ul>
          <li>Calibri (TrueType-based, professional, for corporate branding)</li>
          <li>Pristina (Elegant script, refined cursive, for premium branding)</li>
          <li>Logo (Custom logo font, for company-specific branding)</li>
        </ul>
      </li>
      <li>Add a note box documenting February 2026 font enhancements:
        <ul>
          <li>Vertical positioning adjustments for Calibri and Pristina</li>
          <li>Custom logo font implementation</li>
          <li>G-code file download functionality</li>
          <li>Improved spacing algorithms</li>
        </ul>
      </li>
    </ul>
  </li>
  <li><strong>Feature Documentation:</strong>
    <ul>
      <li>Add calibration tool feature to the Classic Web UI features list</li>
      <li>Note that calibration page was added in February 2026</li>
    </ul>
  </li>
  <li><strong>Table of Contents:</strong>
    <ul>
      <li>Insert new Section 5 (User Interface) with subsections</li>
      <li>Renumber subsequent sections (Deployment becomes 6, Security becomes 7, Appendix becomes 8)</li>
      <li>Update all internal section references and numbering</li>
    </ul>
  </li>
  <li><strong>Development Prompts Appendix:</strong>
    <ul>
      <li>Add two new prompt entries (Prompts #7 and #8)</li>
      <li>Include both original and refactored versions following existing format</li>
      <li>Update all appendix subsection numbers from 7.x to 8.x</li>
    </ul>
  </li>
</ol>

<strong>Quality Standards:</strong>
<ul>
  <li>Maintain consistent formatting with existing document style</li>
  <li>Ensure all cross-references and navigation links work correctly</li>
  <li>Preserve all existing content unless explicitly superseded</li>
  <li>Use professional technical writing tone throughout</li>
  <li>Validate HTML structure and ensure proper nesting</li>
</ul>

<strong>Expected Outcome:</strong> An updated specification document (version 1.1) that comprehensively documents the dual UI strategy, new font capabilities, calibration features, and recent enhancements while maintaining the professional structure and formatting of the original document.
</div>

<hr style="margin-top: 50px;">
<p style="text-align: center; color: #999; font-size: 10pt;">
  CNC Chocolate Engraver - Technical Specification v1.1<br>
  Last Updated: February 15, 2026<br>
  Generated: January 2026 | Revised: February 2026
</p>

</body>
</html>
